{
  "metadata": {
    "created_at": "2026-01-20T03:13:03.680763",
    "last_updated": "2026-01-20T03:13:03.680767",
    "total_factors": 30,
    "version": "1.0",
    "note": "Round 4 factors with RankIC > 0.02, top 30 by RankIC from gemini_123"
  },
  "factors": {
    "2ce5229d90e4d096": {
      "factor_id": "2ce5229d90e4d096",
      "factor_name": "Breakout_Base_Regime_Factor",
      "factor_expression": "TS_QUANTILE($low / ($open + 1e-8), 20, 0.95) * TS_CORR($return, DELTA($volume, 1), 10) * (($high - $low) / (TS_MEAN($high - $low, 20) + 1e-8))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"TS_QUANTILE($low / ($open + 1e-8), 20, 0.95) * TS_CORR($close / (DELAY($close, 1) + 1e-8), DELTA($volume, 1), 10) * (($high - $low) / (TS_MEAN($high - $low, 20) + 1e-8))\" # Your output factor expression will be filled in here\n    name = \"Breakout_Base_Regime_Factor\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor identifies 'Breakout-from-Base' regimes by combining a structural support floor (20-day 95th percentile of low/open) with a volume-validated volatility shock. It captures assets with institutional support that are experiencing a high-conviction breakout validated by price-volume correlation and range expansion.",
      "factor_formulation": "BBR = \\text{TS\\_QUANTILE}(\\frac{low}{open}, 20, 0.95) \\times \\text{TS\\_CORR}(return, \\text{DELTA}(volume, 1), 10) \\times \\frac{high - low}{\\text{TS\\_MEAN}(high - low, 20)}",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "a0730452ad30",
        "parent_trajectory_ids": [
          "7fbab4d1b9e3",
          "f3323be14550"
        ],
        "hypothesis": "Hypothesis: A hybrid factor that identifies 'Breakout-from-Base' regimes by multiplying a structural support floor (20-day 95th percentile of low/open) with a volume-validated volatility shock (10-day price-volume correlation times the 5-day range expansion) will outperform single-signal momentum or accumulation factors.\n                Concise Observation: Parent 1 captures momentum through volatility shocks but risks chasing noise; Parent 2 identifies stable accumulation but lacks a timing trigger for immediate trend initiation.\n                Concise Justification: Combining the support floor (safety) with the volume-weighted volatility shock (momentum) creates a synergistic signal that filters for assets with both structural readiness and active institutional participation.\n                Concise Knowledge: If a stock maintains a high price floor relative to its opening (institutional support) and then experiences a volume-backed volatility expansion, it indicates a high-conviction breakout; When price-volume correlation is high during volatility spikes, the trend is more likely to persist than during low-volume spikes.\n                concise Specification: The factor is defined as the product of the 20-day 95th percentile of ($low/$open) and the 10-day correlation between returns and volume changes, further scaled by the ratio of the 5-day price range ($high-$low) to its 20-day average.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T08:38:36.907125"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1230860924942962,
        "ICIR": 0.0651181104157816,
        "1day.excess_return_without_cost.std": 0.0046355767864274,
        "1day.excess_return_with_cost.annualized_return": 0.0120148666385015,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002510785783981,
        "1day.excess_return_without_cost.annualized_return": 0.0597567016587574,
        "1day.excess_return_with_cost.std": 0.0046355068844791,
        "Rank IC": 0.0337379865250293,
        "IC": 0.0096848844230433,
        "1day.excess_return_without_cost.max_drawdown": -0.1000972919839564,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.835592166994478,
        "1day.pa": 0.0,
        "l2.valid": 0.9967956098528424,
        "Rank ICIR": 0.2272209157084256,
        "l2.train": 0.9934523147834045,
        "1day.excess_return_with_cost.information_ratio": 0.1680092703375308,
        "1day.excess_return_with_cost.mean": 5.048263293488047e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of the 'Breakout-from-Base' regime hypothesis. The 'Breakout_Base_Regime_Factor' (BBR) and its components were evaluated against the previous SOTA. The results show a significant improvement in Information Coefficient (IC) from 0.0058 to 0.0097 and an increase in Annualized Return from 5.2% to 5.98%. However, the Information Ratio (IR) decreased slightly, and the Max Drawdown (MDD) worsened, suggesting that while the signal's predictive power (IC) and absolute return increased, the volatility of the excess returns also rose.",
        "hypothesis_evaluation": "The results generally support the hypothesis that combining structural support (low/open quantile) with volume-validated volatility shocks provides a stronger predictive signal than single-factor models, specifically evidenced by the near-doubling of the IC. However, the current implementation of the 'Breakout_Base_Regime_Factor' uses 5 distinct raw features ($low, $open, $high, $volume, $return), which is approaching the complexity limit (ER > 6). The interaction between the price-volume correlation and the range expansion seems to be the primary driver of the IC improvement.",
        "decision": true,
        "reason": "The current BBR factor successfully increased IC but at the cost of higher drawdown. By replacing the raw range expansion (high-low) with a volatility-normalized version (e.g., ATR-based or Z-score of volume-weighted range), we can identify higher-quality breakouts. Additionally, simplifying the 'structural support' component will reduce the base feature count and potential overfitting, focusing on the synergy between volume confirmation and price momentum rather than just extreme price levels."
      },
      "cache_location": null
    },
    "d769ba778471c5d3": {
      "factor_id": "d769ba778471c5d3",
      "factor_name": "Institutional_Support_Volatility_Shock",
      "factor_expression": "TS_QUANTILE($low / ($open + 1e-8), 20, 0.90) * (($high - $low) / (TS_MEAN($high - $low, 20) + 1e-8))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"TS_QUANTILE($low / ($open + 1e-8), 20, 0.90) * (($high - $low) / (TS_MEAN($high - $low, 20) + 1e-8))\" # Your output factor expression will be filled in here\n    name = \"Institutional_Support_Volatility_Shock\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A simplified version of the breakout hypothesis focusing on the interaction between the price floor stability and recent volatility expansion. It uses the 20-day 90th percentile of the low-to-open ratio as a proxy for support and scales it by the 5-day range relative to its 20-day average.",
      "factor_formulation": "ISVS = \\text{TS\\_QUANTILE}(\\frac{low}{open}, 20, 0.9) \\times \\frac{high - low}{\\text{TS\\_MEAN}(high - low, 20)}",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "a0730452ad30",
        "parent_trajectory_ids": [
          "7fbab4d1b9e3",
          "f3323be14550"
        ],
        "hypothesis": "Hypothesis: A hybrid factor that identifies 'Breakout-from-Base' regimes by multiplying a structural support floor (20-day 95th percentile of low/open) with a volume-validated volatility shock (10-day price-volume correlation times the 5-day range expansion) will outperform single-signal momentum or accumulation factors.\n                Concise Observation: Parent 1 captures momentum through volatility shocks but risks chasing noise; Parent 2 identifies stable accumulation but lacks a timing trigger for immediate trend initiation.\n                Concise Justification: Combining the support floor (safety) with the volume-weighted volatility shock (momentum) creates a synergistic signal that filters for assets with both structural readiness and active institutional participation.\n                Concise Knowledge: If a stock maintains a high price floor relative to its opening (institutional support) and then experiences a volume-backed volatility expansion, it indicates a high-conviction breakout; When price-volume correlation is high during volatility spikes, the trend is more likely to persist than during low-volume spikes.\n                concise Specification: The factor is defined as the product of the 20-day 95th percentile of ($low/$open) and the 10-day correlation between returns and volume changes, further scaled by the ratio of the 5-day price range ($high-$low) to its 20-day average.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T08:38:36.907125"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1230860924942962,
        "ICIR": 0.0651181104157816,
        "1day.excess_return_without_cost.std": 0.0046355767864274,
        "1day.excess_return_with_cost.annualized_return": 0.0120148666385015,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002510785783981,
        "1day.excess_return_without_cost.annualized_return": 0.0597567016587574,
        "1day.excess_return_with_cost.std": 0.0046355068844791,
        "Rank IC": 0.0337379865250293,
        "IC": 0.0096848844230433,
        "1day.excess_return_without_cost.max_drawdown": -0.1000972919839564,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.835592166994478,
        "1day.pa": 0.0,
        "l2.valid": 0.9967956098528424,
        "Rank ICIR": 0.2272209157084256,
        "l2.train": 0.9934523147834045,
        "1day.excess_return_with_cost.information_ratio": 0.1680092703375308,
        "1day.excess_return_with_cost.mean": 5.048263293488047e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of the 'Breakout-from-Base' regime hypothesis. The 'Breakout_Base_Regime_Factor' (BBR) and its components were evaluated against the previous SOTA. The results show a significant improvement in Information Coefficient (IC) from 0.0058 to 0.0097 and an increase in Annualized Return from 5.2% to 5.98%. However, the Information Ratio (IR) decreased slightly, and the Max Drawdown (MDD) worsened, suggesting that while the signal's predictive power (IC) and absolute return increased, the volatility of the excess returns also rose.",
        "hypothesis_evaluation": "The results generally support the hypothesis that combining structural support (low/open quantile) with volume-validated volatility shocks provides a stronger predictive signal than single-factor models, specifically evidenced by the near-doubling of the IC. However, the current implementation of the 'Breakout_Base_Regime_Factor' uses 5 distinct raw features ($low, $open, $high, $volume, $return), which is approaching the complexity limit (ER > 6). The interaction between the price-volume correlation and the range expansion seems to be the primary driver of the IC improvement.",
        "decision": true,
        "reason": "The current BBR factor successfully increased IC but at the cost of higher drawdown. By replacing the raw range expansion (high-low) with a volatility-normalized version (e.g., ATR-based or Z-score of volume-weighted range), we can identify higher-quality breakouts. Additionally, simplifying the 'structural support' component will reduce the base feature count and potential overfitting, focusing on the synergy between volume confirmation and price momentum rather than just extreme price levels."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221528",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528",
        "factor_dir": "29dd9acf2c504bddad8aa77931f7cb10",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528/29dd9acf2c504bddad8aa77931f7cb10/result.h5"
      }
    },
    "73cf10a16107f3eb": {
      "factor_id": "73cf10a16107f3eb",
      "factor_name": "Volume_Validated_Momentum_Trigger",
      "factor_expression": "TS_CORR($return, DELTA($volume, 1), 10) * TS_ZSCORE($high - $low, 20)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"TS_CORR(TS_PCTCHANGE($close, 1), DELTA($volume, 1), 10) * TS_ZSCORE($high - $low, 20)\" # Your output factor expression will be filled in here\n    name = \"Volume_Validated_Momentum_Trigger\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor isolates the momentum trigger part of the hypothesis, focusing on the correlation between returns and volume changes during periods of price range expansion. It identifies high-conviction moves where price and volume are synchronized.",
      "factor_formulation": "VVMT = \\text{TS\\_CORR}(return, \\text{DELTA}(volume, 1), 10) \\times \\text{TS\\_ZSCORE}(high - low, 20)",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "a0730452ad30",
        "parent_trajectory_ids": [
          "7fbab4d1b9e3",
          "f3323be14550"
        ],
        "hypothesis": "Hypothesis: A hybrid factor that identifies 'Breakout-from-Base' regimes by multiplying a structural support floor (20-day 95th percentile of low/open) with a volume-validated volatility shock (10-day price-volume correlation times the 5-day range expansion) will outperform single-signal momentum or accumulation factors.\n                Concise Observation: Parent 1 captures momentum through volatility shocks but risks chasing noise; Parent 2 identifies stable accumulation but lacks a timing trigger for immediate trend initiation.\n                Concise Justification: Combining the support floor (safety) with the volume-weighted volatility shock (momentum) creates a synergistic signal that filters for assets with both structural readiness and active institutional participation.\n                Concise Knowledge: If a stock maintains a high price floor relative to its opening (institutional support) and then experiences a volume-backed volatility expansion, it indicates a high-conviction breakout; When price-volume correlation is high during volatility spikes, the trend is more likely to persist than during low-volume spikes.\n                concise Specification: The factor is defined as the product of the 20-day 95th percentile of ($low/$open) and the 10-day correlation between returns and volume changes, further scaled by the ratio of the 5-day price range ($high-$low) to its 20-day average.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T08:38:36.907125"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1230860924942962,
        "ICIR": 0.0651181104157816,
        "1day.excess_return_without_cost.std": 0.0046355767864274,
        "1day.excess_return_with_cost.annualized_return": 0.0120148666385015,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002510785783981,
        "1day.excess_return_without_cost.annualized_return": 0.0597567016587574,
        "1day.excess_return_with_cost.std": 0.0046355068844791,
        "Rank IC": 0.0337379865250293,
        "IC": 0.0096848844230433,
        "1day.excess_return_without_cost.max_drawdown": -0.1000972919839564,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.835592166994478,
        "1day.pa": 0.0,
        "l2.valid": 0.9967956098528424,
        "Rank ICIR": 0.2272209157084256,
        "l2.train": 0.9934523147834045,
        "1day.excess_return_with_cost.information_ratio": 0.1680092703375308,
        "1day.excess_return_with_cost.mean": 5.048263293488047e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of the 'Breakout-from-Base' regime hypothesis. The 'Breakout_Base_Regime_Factor' (BBR) and its components were evaluated against the previous SOTA. The results show a significant improvement in Information Coefficient (IC) from 0.0058 to 0.0097 and an increase in Annualized Return from 5.2% to 5.98%. However, the Information Ratio (IR) decreased slightly, and the Max Drawdown (MDD) worsened, suggesting that while the signal's predictive power (IC) and absolute return increased, the volatility of the excess returns also rose.",
        "hypothesis_evaluation": "The results generally support the hypothesis that combining structural support (low/open quantile) with volume-validated volatility shocks provides a stronger predictive signal than single-factor models, specifically evidenced by the near-doubling of the IC. However, the current implementation of the 'Breakout_Base_Regime_Factor' uses 5 distinct raw features ($low, $open, $high, $volume, $return), which is approaching the complexity limit (ER > 6). The interaction between the price-volume correlation and the range expansion seems to be the primary driver of the IC improvement.",
        "decision": true,
        "reason": "The current BBR factor successfully increased IC but at the cost of higher drawdown. By replacing the raw range expansion (high-low) with a volatility-normalized version (e.g., ATR-based or Z-score of volume-weighted range), we can identify higher-quality breakouts. Additionally, simplifying the 'structural support' component will reduce the base feature count and potential overfitting, focusing on the synergy between volume confirmation and price momentum rather than just extreme price levels."
      },
      "cache_location": null
    },
    "111a20ad03bb45cf": {
      "factor_id": "111a20ad03bb45cf",
      "factor_name": "Liquidity_Anchored_Capitulation_20D",
      "factor_expression": "TS_PCTCHANGE($close, 60) * (-1 * TS_CORR($close, $volume, 20)) * (($high - $low) / ($close + 1e-8)) / (TS_STD($volume / (TS_MEAN($volume, 20) + 1e-8), 20) + 1e-8)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"TS_PCTCHANGE($close, 60) * (-1 * TS_CORR($close, $volume, 20)) * (($high - $low) / ($close + 1e-8)) / (TS_STD($volume / (TS_MEAN($volume, 20) + 1e-8), 20) + 1e-8)\" # Your output factor expression will be filled in here\n    name = \"Liquidity_Anchored_Capitulation_20D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor identifies structural exhaustion by combining 60-day momentum, price-volume divergence, and intraday volatility normalized by volume stability. It seeks to capture macro reversals that occur during retail-driven liquidity gaps.",
      "factor_formulation": "\\text{TS_PCTCHANGE}(\\text{close}, 60) \\times -\\text{TS_CORR}(\\text{close}, \\text{volume}, 20) \\times \\frac{(\\text{high} - \\text{low}) / \\text{close}}{\\text{TS_STD}(\\text{volume} / \\text{TS_MEAN}(\\text{volume}, 20), 20)}",
      "metadata": {
        "experiment_id": "2026-01-19_04-13-15-519909",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "f8391ac53df9",
        "parent_trajectory_ids": [
          "dd5d04f8fbd6",
          "4d97d08439d6"
        ],
        "hypothesis": "Hypothesis: The 'Liquidity-Anchored Structural Capitulation' factor identifies high-conviction reversals by multiplying a 60-day momentum-reversal index (ROC60 * -Corr(Price, Volume, 20)) with a 20-day intraday liquidity vacuum metric (Intraday Range / Std(Volume, 20)), effectively isolating macro exhaustion points that coincide with retail-driven liquidity gaps.\n                Concise Observation: Parent 1's liquidity vacuum captured short-term noise (RankIC 0.0268) and Parent 2's structural capitulation captured macro reversals (RankIC 0.0266); however, both suffered from false signals during high-regime institutional trending phases where liquidity was deep.\n                Concise Justification: By filtering macro capitulation signals through an intraday liquidity lens, we ensure that the reversal signal is triggered only when the market lacks the institutional depth to sustain the current trend, thereby reducing 'value trap' entries in trending markets.\n                Concise Knowledge: If a long-term price trend reaches a structural exhaustion point (negative price-volume correlation) during a period of low turnover stability and high intraday dispersion, then the probability of a sharp mean-reversion increase; when institutional liquidity is absent, retail-driven price gaps are more likely to be filled.\n                concise Specification: The factor is calculated as (Close/Delay(Close, 60) - 1) * -Corr(Close, Volume, 20) * ((High - Low) / Close) / Std(Volume/Mean(Volume, 20), 20), where all components use a 20-day window for stability except for the 60-day momentum anchor.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T16:07:02.872199"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1343558830636987,
        "ICIR": 0.0691080539297962,
        "1day.excess_return_without_cost.std": 0.0046033365136695,
        "1day.excess_return_with_cost.annualized_return": 0.026374690968827,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003093747544353,
        "1day.excess_return_without_cost.annualized_return": 0.0736311915556064,
        "1day.excess_return_with_cost.std": 0.0046039522516008,
        "Rank IC": 0.0316611135492649,
        "IC": 0.0105234934120766,
        "1day.excess_return_without_cost.max_drawdown": -0.1209649540602824,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.0368134589813176,
        "1day.pa": 0.0,
        "l2.valid": 0.9968165323192668,
        "Rank ICIR": 0.2066218163856006,
        "l2.train": 0.9934884376411416,
        "1day.excess_return_with_cost.information_ratio": 0.3713368853377408,
        "1day.excess_return_with_cost.mean": 0.0001108180292807
      },
      "feedback": {
        "observations": "The current iteration demonstrates a significant improvement in predictive power and risk-adjusted returns. The 'Liquidity_Anchored_Capitulation_20D' and its variants have successfully pushed the Information Ratio (IR) from 0.97 to 1.03 and nearly doubled the IC from 0.0058 to 0.0105. However, this gain in return and IC comes at the cost of a higher Max Drawdown (-0.12 vs -0.07), suggesting that while the 'capitulation' signals are more accurate, they may be more volatile or concentrated in specific market regimes.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that combining long-term momentum reversal (ROC60) with price-volume divergence and liquidity vacuum metrics (Intraday Range / Volume Volatility) captures high-conviction reversal points. The 'Structural_Exhaustion_Rank_Index' suggests that cross-sectional ranking of these components helps in isolating the signal from market noise, while the 'Capitulation_Volume_Volatility_Ratio' confirms that the ratio of price dispersion to volume stability is a potent multiplier for reversal signals.",
        "decision": true,
        "reason": "The current best factor uses a complex denominator involving the standard deviation of a normalized volume, which increases the 'Symbol Length' and potential for overfitting. By simplifying the liquidity component to a direct ratio of current volume to its mean, we maintain the 'liquidity vacuum' logic while reducing the parameter count. Additionally, using a Z-score for the 60-day momentum will provide a more stable anchor for the reversal signal across different market regimes than a simple percentage change."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221443",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221443",
        "factor_dir": "eecfab1cb8b34bdc97d2521671b77011",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221443/eecfab1cb8b34bdc97d2521671b77011/result.h5"
      }
    },
    "e68d64e5b80b28d4": {
      "factor_id": "e68d64e5b80b28d4",
      "factor_name": "Structural_Exhaustion_Rank_Index",
      "factor_expression": "RANK(-1 * TS_CORR($close, $volume, 20)) * RANK(TS_ZSCORE(($high - $low) / ($close + 1e-8), 20))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(-1 * TS_CORR($close, $volume, 20)) * RANK(TS_ZSCORE(($high - $low) / ($close + 1e-8), 20))\" # Your output factor expression will be filled in here\n    name = \"Structural_Exhaustion_Rank_Index\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A simplified version of the capitulation hypothesis focusing on the cross-sectional rank of price-volume divergence weighted by relative intraday range, designed to isolate exhaustion in low-institutional-depth environments.",
      "factor_formulation": "\\text{RANK}(-\\text{TS_CORR}(\\text{close}, \\text{volume}, 20)) \\times \\text{RANK}(\\text{TS_ZSCORE}((\\text{high} - \\text{low}) / \\text{close}, 20))",
      "metadata": {
        "experiment_id": "2026-01-19_04-13-15-519909",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "f8391ac53df9",
        "parent_trajectory_ids": [
          "dd5d04f8fbd6",
          "4d97d08439d6"
        ],
        "hypothesis": "Hypothesis: The 'Liquidity-Anchored Structural Capitulation' factor identifies high-conviction reversals by multiplying a 60-day momentum-reversal index (ROC60 * -Corr(Price, Volume, 20)) with a 20-day intraday liquidity vacuum metric (Intraday Range / Std(Volume, 20)), effectively isolating macro exhaustion points that coincide with retail-driven liquidity gaps.\n                Concise Observation: Parent 1's liquidity vacuum captured short-term noise (RankIC 0.0268) and Parent 2's structural capitulation captured macro reversals (RankIC 0.0266); however, both suffered from false signals during high-regime institutional trending phases where liquidity was deep.\n                Concise Justification: By filtering macro capitulation signals through an intraday liquidity lens, we ensure that the reversal signal is triggered only when the market lacks the institutional depth to sustain the current trend, thereby reducing 'value trap' entries in trending markets.\n                Concise Knowledge: If a long-term price trend reaches a structural exhaustion point (negative price-volume correlation) during a period of low turnover stability and high intraday dispersion, then the probability of a sharp mean-reversion increase; when institutional liquidity is absent, retail-driven price gaps are more likely to be filled.\n                concise Specification: The factor is calculated as (Close/Delay(Close, 60) - 1) * -Corr(Close, Volume, 20) * ((High - Low) / Close) / Std(Volume/Mean(Volume, 20), 20), where all components use a 20-day window for stability except for the 60-day momentum anchor.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T16:07:02.872199"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1343558830636987,
        "ICIR": 0.0691080539297962,
        "1day.excess_return_without_cost.std": 0.0046033365136695,
        "1day.excess_return_with_cost.annualized_return": 0.026374690968827,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003093747544353,
        "1day.excess_return_without_cost.annualized_return": 0.0736311915556064,
        "1day.excess_return_with_cost.std": 0.0046039522516008,
        "Rank IC": 0.0316611135492649,
        "IC": 0.0105234934120766,
        "1day.excess_return_without_cost.max_drawdown": -0.1209649540602824,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.0368134589813176,
        "1day.pa": 0.0,
        "l2.valid": 0.9968165323192668,
        "Rank ICIR": 0.2066218163856006,
        "l2.train": 0.9934884376411416,
        "1day.excess_return_with_cost.information_ratio": 0.3713368853377408,
        "1day.excess_return_with_cost.mean": 0.0001108180292807
      },
      "feedback": {
        "observations": "The current iteration demonstrates a significant improvement in predictive power and risk-adjusted returns. The 'Liquidity_Anchored_Capitulation_20D' and its variants have successfully pushed the Information Ratio (IR) from 0.97 to 1.03 and nearly doubled the IC from 0.0058 to 0.0105. However, this gain in return and IC comes at the cost of a higher Max Drawdown (-0.12 vs -0.07), suggesting that while the 'capitulation' signals are more accurate, they may be more volatile or concentrated in specific market regimes.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that combining long-term momentum reversal (ROC60) with price-volume divergence and liquidity vacuum metrics (Intraday Range / Volume Volatility) captures high-conviction reversal points. The 'Structural_Exhaustion_Rank_Index' suggests that cross-sectional ranking of these components helps in isolating the signal from market noise, while the 'Capitulation_Volume_Volatility_Ratio' confirms that the ratio of price dispersion to volume stability is a potent multiplier for reversal signals.",
        "decision": true,
        "reason": "The current best factor uses a complex denominator involving the standard deviation of a normalized volume, which increases the 'Symbol Length' and potential for overfitting. By simplifying the liquidity component to a direct ratio of current volume to its mean, we maintain the 'liquidity vacuum' logic while reducing the parameter count. Additionally, using a Z-score for the 60-day momentum will provide a more stable anchor for the reversal signal across different market regimes than a simple percentage change."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221443",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221443",
        "factor_dir": "5a2b3a8482204de5a732fc979da11f1d",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221443/5a2b3a8482204de5a732fc979da11f1d/result.h5"
      }
    },
    "5230b1b1402f1bb5": {
      "factor_id": "5230b1b1402f1bb5",
      "factor_name": "Capitulation_Volume_Volatility_Ratio",
      "factor_expression": "SIGN(DELAY($close, 60) - $close) * (($high - $low) / ($close + 1e-8)) / (TS_STD($volume, 20) / (TS_MEAN($volume, 20) + 1e-8) + 1e-8)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"SIGN(DELAY($close, 60) - $close) * (($high - $low) / ($close + 1e-8)) / (TS_STD($volume, 20) / (TS_MEAN($volume, 20) + 1e-8) + 1e-8)\" # Your output factor expression will be filled in here\n    name = \"Capitulation_Volume_Volatility_Ratio\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor targets the liquidity vacuum aspect of the hypothesis by measuring the ratio of price dispersion to volume volatility, conditioned on a long-term momentum reversal signal.",
      "factor_formulation": "\\text{SIGN}(\\text{DELAY}(\\text{close}, 60) - \\text{close}) \\times \\frac{(\\text{high} - \\text{low}) / \\text{close}}{\\text{TS_STD}(\\text{volume}, 20) / \\text{TS_MEAN}(\\text{volume}, 20)}",
      "metadata": {
        "experiment_id": "2026-01-19_04-13-15-519909",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "f8391ac53df9",
        "parent_trajectory_ids": [
          "dd5d04f8fbd6",
          "4d97d08439d6"
        ],
        "hypothesis": "Hypothesis: The 'Liquidity-Anchored Structural Capitulation' factor identifies high-conviction reversals by multiplying a 60-day momentum-reversal index (ROC60 * -Corr(Price, Volume, 20)) with a 20-day intraday liquidity vacuum metric (Intraday Range / Std(Volume, 20)), effectively isolating macro exhaustion points that coincide with retail-driven liquidity gaps.\n                Concise Observation: Parent 1's liquidity vacuum captured short-term noise (RankIC 0.0268) and Parent 2's structural capitulation captured macro reversals (RankIC 0.0266); however, both suffered from false signals during high-regime institutional trending phases where liquidity was deep.\n                Concise Justification: By filtering macro capitulation signals through an intraday liquidity lens, we ensure that the reversal signal is triggered only when the market lacks the institutional depth to sustain the current trend, thereby reducing 'value trap' entries in trending markets.\n                Concise Knowledge: If a long-term price trend reaches a structural exhaustion point (negative price-volume correlation) during a period of low turnover stability and high intraday dispersion, then the probability of a sharp mean-reversion increase; when institutional liquidity is absent, retail-driven price gaps are more likely to be filled.\n                concise Specification: The factor is calculated as (Close/Delay(Close, 60) - 1) * -Corr(Close, Volume, 20) * ((High - Low) / Close) / Std(Volume/Mean(Volume, 20), 20), where all components use a 20-day window for stability except for the 60-day momentum anchor.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T16:07:02.872199"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1343558830636987,
        "ICIR": 0.0691080539297962,
        "1day.excess_return_without_cost.std": 0.0046033365136695,
        "1day.excess_return_with_cost.annualized_return": 0.026374690968827,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003093747544353,
        "1day.excess_return_without_cost.annualized_return": 0.0736311915556064,
        "1day.excess_return_with_cost.std": 0.0046039522516008,
        "Rank IC": 0.0316611135492649,
        "IC": 0.0105234934120766,
        "1day.excess_return_without_cost.max_drawdown": -0.1209649540602824,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.0368134589813176,
        "1day.pa": 0.0,
        "l2.valid": 0.9968165323192668,
        "Rank ICIR": 0.2066218163856006,
        "l2.train": 0.9934884376411416,
        "1day.excess_return_with_cost.information_ratio": 0.3713368853377408,
        "1day.excess_return_with_cost.mean": 0.0001108180292807
      },
      "feedback": {
        "observations": "The current iteration demonstrates a significant improvement in predictive power and risk-adjusted returns. The 'Liquidity_Anchored_Capitulation_20D' and its variants have successfully pushed the Information Ratio (IR) from 0.97 to 1.03 and nearly doubled the IC from 0.0058 to 0.0105. However, this gain in return and IC comes at the cost of a higher Max Drawdown (-0.12 vs -0.07), suggesting that while the 'capitulation' signals are more accurate, they may be more volatile or concentrated in specific market regimes.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that combining long-term momentum reversal (ROC60) with price-volume divergence and liquidity vacuum metrics (Intraday Range / Volume Volatility) captures high-conviction reversal points. The 'Structural_Exhaustion_Rank_Index' suggests that cross-sectional ranking of these components helps in isolating the signal from market noise, while the 'Capitulation_Volume_Volatility_Ratio' confirms that the ratio of price dispersion to volume stability is a potent multiplier for reversal signals.",
        "decision": true,
        "reason": "The current best factor uses a complex denominator involving the standard deviation of a normalized volume, which increases the 'Symbol Length' and potential for overfitting. By simplifying the liquidity component to a direct ratio of current volume to its mean, we maintain the 'liquidity vacuum' logic while reducing the parameter count. Additionally, using a Z-score for the 60-day momentum will provide a more stable anchor for the reversal signal across different market regimes than a simple percentage change."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221443",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221443",
        "factor_dir": "f12f1656fadf4dbcb978e6b899c48907",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221443/f12f1656fadf4dbcb978e6b899c48907/result.h5"
      }
    },
    "203ebbd011bcba85": {
      "factor_id": "203ebbd011bcba85",
      "factor_name": "Institutional_Absorption_Exhaustion_V1",
      "factor_expression": "(TS_MEAN($volume, 20) / (TS_MEAN($high - $low, 5) + 1e-8)) * (ABS($close - TS_MEAN($close, 20)) / (ABS(TS_ZSCORE($volume, 5)) + 1e-8))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"(TS_MEAN($volume, 20) / (TS_MEAN($high - $low, 5) + 1e-8)) * (ABS($close - TS_MEAN($close, 20)) / (ABS(TS_ZSCORE($volume, 5)) + 1e-8))\" # Your output factor expression will be filled in here\n    name = \"Institutional_Absorption_Exhaustion_V1\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor identifies the transition from institutional accumulation to exhaustion. It multiplies the 20-day Volume-to-Volatility Efficiency (measuring dense accumulation) by an Exhaustion Metric (measuring price distance from the mean relative to volume intensity). High values suggest a trend climax or imminent reversal.",
      "factor_formulation": "\\text{Efficiency} = \\frac{\\text{TS\\_MEAN}(\\text{volume}, 20)}{\\text{TS\\_MEAN}(\\text{high} - \\text{low}, 5)} \\times \\frac{\\text{ABS}(\\text{close} - \\text{TS\\_MEAN}(\\text{close}, 20))}{\\text{TS\\_ZSCORE}(\\text{volume}, 5) + 1e-8}",
      "metadata": {
        "experiment_id": "2026-01-18_23-34-31-850258",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "387950aa85fb",
        "parent_trajectory_ids": [
          "492e236353d7",
          "2c6dd6986e79"
        ],
        "hypothesis": "Hypothesis: The 'Institutional Absorption-Exhaustion' factor, calculated as the product of the 20-day Volume-to-Volatility Efficiency and the 5-day Price-Volume Divergence, identifies high-alpha opportunities by detecting the transition from efficient institutional accumulation to terminal liquidity climaxes.\n                Concise Observation: Parent 1 successfully captured reversals using volume surges but suffered from noise, while Parent 2 identified stable accumulation through efficiency but lacked timing; combining them reveals the transition point between stable positioning and volatile exhaustion.\n                Concise Justification: Institutional investors minimize price impact during accumulation (low volatility, high volume), but as the available liquidity is exhausted, the same volume causes larger price swings, signaling the end of the current regime and a high-probability turning point.\n                Concise Knowledge: If high volume-to-volatility efficiency (Dense Accumulation) is followed by a sharp increase in price range relative to volume (Exhaustion), then a price reversal or trend climax is imminent; When institutional absorption ends, liquidity becomes thin, leading to volatile price movements.\n                concise Specification: Calculate the Efficiency Ratio (20-day mean volume / 5-day mean high-low range) and multiply it by the Exhaustion Metric (5-day price distance from its 20-day MA normalized by the 5-day volume Z-score) to capture the climax of the institutional cycle.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T12:38:41.422617"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.091713870274904,
        "ICIR": 0.0601851795124652,
        "1day.excess_return_without_cost.std": 0.0043196755539739,
        "1day.excess_return_with_cost.annualized_return": 0.0328392947940326,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003375486566104,
        "1day.excess_return_without_cost.annualized_return": 0.0803365802732867,
        "1day.excess_return_with_cost.std": 0.0043209602520171,
        "Rank IC": 0.0294161591773144,
        "IC": 0.0085934835185732,
        "1day.excess_return_without_cost.max_drawdown": -0.0812018147063896,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.2055180955126286,
        "1day.pa": 0.0,
        "l2.valid": 0.9964088664030896,
        "Rank ICIR": 0.2100621497165812,
        "l2.train": 0.9936285299381272,
        "1day.excess_return_with_cost.information_ratio": 0.4926347830758689,
        "1day.excess_return_with_cost.mean": 0.000137980230227
      },
      "feedback": {
        "observations": "The current iteration significantly improved the Information Ratio (from 0.97 to 1.21), Annualized Return (from 5.2% to 8.0%), and IC (from 0.0058 to 0.0086) compared to the previous SOTA. While the Max Drawdown slightly increased, the overall risk-adjusted performance (IR) and predictive power (IC) demonstrate a robust advancement in capturing market regime shifts. The 'Absorption_Exhaustion_ZScore' and 'LCER' variants successfully simplified the complex logic of V1 into more interpretable price-volume efficiency metrics.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that the transition from institutional absorption to exhaustion provides high-alpha opportunities. The success of the 'Absorption_Exhaustion_ZScore' suggests that the divergence between volume efficiency (volume per price unit) and raw price volatility is a more potent signal than the absolute distance from the mean used in V1. The 20-day window for volume normalization combined with a shorter 5-day window for volatility captures the 'climax' effect effectively.",
        "decision": true,
        "reason": "While the current Z-score approach is effective, it captures a state rather than a turning point. By calculating the 'velocity' (rate of change) of the efficiency ratio, we can pinpoint the deceleration of institutional support. Furthermore, reducing the number of base features and focusing on the ratio of $volume to ($high - $low) maintains low complexity (SL < 50) while improving the timing of the signal. This follows the principle of prioritizing simplicity and capturing the 'regime shift' through momentum in efficiency."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_213430",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_213430",
        "factor_dir": "f17e7a0480a84497a3f4931b2c969f3a",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_213430/f17e7a0480a84497a3f4931b2c969f3a/result.h5"
      }
    },
    "a49b0c3d5317c2f9": {
      "factor_id": "a49b0c3d5317c2f9",
      "factor_name": "Liquidity_Climax_Efficiency_Ratio",
      "factor_expression": "RANK(TS_MEAN($volume, 20) / (TS_STD($return, 20) + 1e-8)) * RANK(ABS(TS_PCTCHANGE($close, 5)))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(TS_MEAN($volume, 20) / (TS_STD(TS_PCTCHANGE($close, 1), 20) + 1e-8)) * RANK(ABS(TS_PCTCHANGE($close, 5)))\" # Your output factor expression will be filled in here\n    name = \"Liquidity_Climax_Efficiency_Ratio\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A simplified version of the absorption-exhaustion hypothesis focusing on the ratio of accumulation efficiency to current price volatility. It captures moments where price movement becomes 'expensive' relative to the volume being traded, signaling a liquidity climax.",
      "factor_formulation": "\\text{LCER} = \\text{RANK}\\left(\\frac{\\text{TS\\_MEAN}(\\text{volume}, 20)}{\\text{TS\\_STD}(\\text{return}, 20)}\\right) \\times \\text{RANK}(\\text{ABS}(\\text{TS\\_PCTCHANGE}(\\text{close}, 5)))",
      "metadata": {
        "experiment_id": "2026-01-18_23-34-31-850258",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "387950aa85fb",
        "parent_trajectory_ids": [
          "492e236353d7",
          "2c6dd6986e79"
        ],
        "hypothesis": "Hypothesis: The 'Institutional Absorption-Exhaustion' factor, calculated as the product of the 20-day Volume-to-Volatility Efficiency and the 5-day Price-Volume Divergence, identifies high-alpha opportunities by detecting the transition from efficient institutional accumulation to terminal liquidity climaxes.\n                Concise Observation: Parent 1 successfully captured reversals using volume surges but suffered from noise, while Parent 2 identified stable accumulation through efficiency but lacked timing; combining them reveals the transition point between stable positioning and volatile exhaustion.\n                Concise Justification: Institutional investors minimize price impact during accumulation (low volatility, high volume), but as the available liquidity is exhausted, the same volume causes larger price swings, signaling the end of the current regime and a high-probability turning point.\n                Concise Knowledge: If high volume-to-volatility efficiency (Dense Accumulation) is followed by a sharp increase in price range relative to volume (Exhaustion), then a price reversal or trend climax is imminent; When institutional absorption ends, liquidity becomes thin, leading to volatile price movements.\n                concise Specification: Calculate the Efficiency Ratio (20-day mean volume / 5-day mean high-low range) and multiply it by the Exhaustion Metric (5-day price distance from its 20-day MA normalized by the 5-day volume Z-score) to capture the climax of the institutional cycle.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T12:38:41.422617"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.091713870274904,
        "ICIR": 0.0601851795124652,
        "1day.excess_return_without_cost.std": 0.0043196755539739,
        "1day.excess_return_with_cost.annualized_return": 0.0328392947940326,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003375486566104,
        "1day.excess_return_without_cost.annualized_return": 0.0803365802732867,
        "1day.excess_return_with_cost.std": 0.0043209602520171,
        "Rank IC": 0.0294161591773144,
        "IC": 0.0085934835185732,
        "1day.excess_return_without_cost.max_drawdown": -0.0812018147063896,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.2055180955126286,
        "1day.pa": 0.0,
        "l2.valid": 0.9964088664030896,
        "Rank ICIR": 0.2100621497165812,
        "l2.train": 0.9936285299381272,
        "1day.excess_return_with_cost.information_ratio": 0.4926347830758689,
        "1day.excess_return_with_cost.mean": 0.000137980230227
      },
      "feedback": {
        "observations": "The current iteration significantly improved the Information Ratio (from 0.97 to 1.21), Annualized Return (from 5.2% to 8.0%), and IC (from 0.0058 to 0.0086) compared to the previous SOTA. While the Max Drawdown slightly increased, the overall risk-adjusted performance (IR) and predictive power (IC) demonstrate a robust advancement in capturing market regime shifts. The 'Absorption_Exhaustion_ZScore' and 'LCER' variants successfully simplified the complex logic of V1 into more interpretable price-volume efficiency metrics.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that the transition from institutional absorption to exhaustion provides high-alpha opportunities. The success of the 'Absorption_Exhaustion_ZScore' suggests that the divergence between volume efficiency (volume per price unit) and raw price volatility is a more potent signal than the absolute distance from the mean used in V1. The 20-day window for volume normalization combined with a shorter 5-day window for volatility captures the 'climax' effect effectively.",
        "decision": true,
        "reason": "While the current Z-score approach is effective, it captures a state rather than a turning point. By calculating the 'velocity' (rate of change) of the efficiency ratio, we can pinpoint the deceleration of institutional support. Furthermore, reducing the number of base features and focusing on the ratio of $volume to ($high - $low) maintains low complexity (SL < 50) while improving the timing of the signal. This follows the principle of prioritizing simplicity and capturing the 'regime shift' through momentum in efficiency."
      },
      "cache_location": null
    },
    "17450be1f78fc2a1": {
      "factor_id": "17450be1f78fc2a1",
      "factor_name": "Absorption_Exhaustion_ZScore",
      "factor_expression": "TS_ZSCORE($volume / ($high - $low + 1e-8), 20) - TS_ZSCORE($high - $low, 5)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"TS_ZSCORE($volume / (MAX($high - $low, 0.001 * $close)), 20) - TS_ZSCORE($high - $low, 5)\" # Your output factor expression will be filled in here\n    name = \"Absorption_Exhaustion_ZScore\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor measures the divergence between volume-based support and price-based volatility. It uses the Z-score of volume efficiency against the Z-score of price range to detect when institutional absorption is no longer able to contain price volatility, indicating a regime shift.",
      "factor_formulation": "\\text{AEZ} = \\text{TS\\_ZSCORE}(\\text{volume} / (\\text{high} - \\text{low} + 1e-8), 20) - \\text{TS\\_ZSCORE}(\\text{high} - \\text{low}, 5)",
      "metadata": {
        "experiment_id": "2026-01-18_23-34-31-850258",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "387950aa85fb",
        "parent_trajectory_ids": [
          "492e236353d7",
          "2c6dd6986e79"
        ],
        "hypothesis": "Hypothesis: The 'Institutional Absorption-Exhaustion' factor, calculated as the product of the 20-day Volume-to-Volatility Efficiency and the 5-day Price-Volume Divergence, identifies high-alpha opportunities by detecting the transition from efficient institutional accumulation to terminal liquidity climaxes.\n                Concise Observation: Parent 1 successfully captured reversals using volume surges but suffered from noise, while Parent 2 identified stable accumulation through efficiency but lacked timing; combining them reveals the transition point between stable positioning and volatile exhaustion.\n                Concise Justification: Institutional investors minimize price impact during accumulation (low volatility, high volume), but as the available liquidity is exhausted, the same volume causes larger price swings, signaling the end of the current regime and a high-probability turning point.\n                Concise Knowledge: If high volume-to-volatility efficiency (Dense Accumulation) is followed by a sharp increase in price range relative to volume (Exhaustion), then a price reversal or trend climax is imminent; When institutional absorption ends, liquidity becomes thin, leading to volatile price movements.\n                concise Specification: Calculate the Efficiency Ratio (20-day mean volume / 5-day mean high-low range) and multiply it by the Exhaustion Metric (5-day price distance from its 20-day MA normalized by the 5-day volume Z-score) to capture the climax of the institutional cycle.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T12:38:41.422617"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.091713870274904,
        "ICIR": 0.0601851795124652,
        "1day.excess_return_without_cost.std": 0.0043196755539739,
        "1day.excess_return_with_cost.annualized_return": 0.0328392947940326,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003375486566104,
        "1day.excess_return_without_cost.annualized_return": 0.0803365802732867,
        "1day.excess_return_with_cost.std": 0.0043209602520171,
        "Rank IC": 0.0294161591773144,
        "IC": 0.0085934835185732,
        "1day.excess_return_without_cost.max_drawdown": -0.0812018147063896,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.2055180955126286,
        "1day.pa": 0.0,
        "l2.valid": 0.9964088664030896,
        "Rank ICIR": 0.2100621497165812,
        "l2.train": 0.9936285299381272,
        "1day.excess_return_with_cost.information_ratio": 0.4926347830758689,
        "1day.excess_return_with_cost.mean": 0.000137980230227
      },
      "feedback": {
        "observations": "The current iteration significantly improved the Information Ratio (from 0.97 to 1.21), Annualized Return (from 5.2% to 8.0%), and IC (from 0.0058 to 0.0086) compared to the previous SOTA. While the Max Drawdown slightly increased, the overall risk-adjusted performance (IR) and predictive power (IC) demonstrate a robust advancement in capturing market regime shifts. The 'Absorption_Exhaustion_ZScore' and 'LCER' variants successfully simplified the complex logic of V1 into more interpretable price-volume efficiency metrics.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that the transition from institutional absorption to exhaustion provides high-alpha opportunities. The success of the 'Absorption_Exhaustion_ZScore' suggests that the divergence between volume efficiency (volume per price unit) and raw price volatility is a more potent signal than the absolute distance from the mean used in V1. The 20-day window for volume normalization combined with a shorter 5-day window for volatility captures the 'climax' effect effectively.",
        "decision": true,
        "reason": "While the current Z-score approach is effective, it captures a state rather than a turning point. By calculating the 'velocity' (rate of change) of the efficiency ratio, we can pinpoint the deceleration of institutional support. Furthermore, reducing the number of base features and focusing on the ratio of $volume to ($high - $low) maintains low complexity (SL < 50) while improving the timing of the signal. This follows the principle of prioritizing simplicity and capturing the 'regime shift' through momentum in efficiency."
      },
      "cache_location": null
    },
    "0a9f9223e8721df1": {
      "factor_id": "0a9f9223e8721df1",
      "factor_name": "Inst_Exhaustion_Momentum_Hybrid",
      "factor_expression": "(($open - DELAY($close, 1)) / (DELAY($close, 1) + 1e-8) / (TS_MEAN(($high - $low) / ($close + 1e-8), 5) + 1e-8)) * TS_ZSCORE(($high - $low) / ($close * $volume + 1e-8), 20)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"(($open - DELAY($close, 1)) / (TS_MEAN($high - $low, 5) + 1e-8)) * TS_ZSCORE(($high - $low) / ($volume + 1e-8), 20)\" # Your output factor expression will be filled in here\n    name = \"Inst_Exhaustion_Momentum_Hybrid\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor identifies market turning points by calculating the ratio of the overnight gap to the 5-day moving average of the intraday range, scaled by the 20-day Z-score of volume efficiency (range-to-volume ratio). High volume efficiency with a gap indicates momentum, while low efficiency indicates exhaustion.",
      "factor_formulation": "\\text{Hybrid} = \\left( \\frac{(\\text{open} - \\text{delay}(\\text{close}, 1)) / \\text{delay}(\\text{close}, 1)}{\\text{TS\\_MEAN}((\\text{high} - \\text{low}) / \\text{close}, 5)} \\right) \\times \\text{TS\\_ZSCORE}\\left( \\frac{(\\text{high} - \\text{low}) / \\text{close}}{\\text{volume} + 1e-8}, 20 \\right)",
      "metadata": {
        "experiment_id": "2026-01-18_23-34-31-850258",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "f2e95768825b",
        "parent_trajectory_ids": [
          "492e236353d7",
          "c7a40ae95b51"
        ],
        "hypothesis": "Hypothesis: The 'Institutional Exhaustion-Momentum Hybrid' factor identifies market turning points by calculating the ratio of the overnight gap to the 5-day volume-weighted intraday range, then scaling this by the 20-day Z-score of volume efficiency (range-to-volume ratio) to distinguish between breakaway momentum and climax exhaustion.\n                Concise Observation: Parent 1 (RankIC=0.0239) succeeds in identifying reversals through liquidity exhaustion, while Parent 2 (RankIC=0.0249) captures momentum from structural shocks; however, both struggle to distinguish between 'climax' volume and 'breakout' volume without cross-temporal normalization.\n                Concise Justification: By normalizing the overnight gap with the intraday range and weighting it by the 20-day relative volume efficiency, the factor captures the 'cost' of price movement, where high-cost gaps (high volume/low range) signal institutional exhaustion and low-cost gaps signal sustainable trends.\n                Concise Knowledge: If an overnight price gap is accompanied by high volume but low intraday price extension (low volume efficiency), it signifies liquidity exhaustion and a likely reversal; conversely, if a gap occurs with high volume efficiency, it indicates a structural momentum shift.\n                concise Specification: The factor is defined as (Overnight Gap / 5-day Moving Average of Intraday Range) multiplied by the 20-day Z-score of (Intraday Range / Volume). The overnight gap is ($open - $close[1]) / $close[1], and the intraday range is ($high - $low) / $close.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T13:26:03.523396"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1187984923827096,
        "ICIR": 0.0582824746554352,
        "1day.excess_return_without_cost.std": 0.0047129371901752,
        "1day.excess_return_with_cost.annualized_return": 0.043837728495333,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003823870846335,
        "1day.excess_return_without_cost.annualized_return": 0.0910081261427928,
        "1day.excess_return_with_cost.std": 0.0047136457506271,
        "Rank IC": 0.0285424697769071,
        "IC": 0.0081112328559831,
        "1day.excess_return_without_cost.max_drawdown": -0.0990788570418628,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.2516993937928804,
        "1day.pa": 0.0,
        "l2.valid": 0.9965540688366494,
        "Rank ICIR": 0.2044980149725562,
        "l2.train": 0.9940511320749748,
        "1day.excess_return_with_cost.information_ratio": 0.6028407807048954,
        "1day.excess_return_with_cost.mean": 0.000184192136535
      },
      "feedback": {
        "observations": "The experiment results demonstrate a significant improvement in predictive performance. The 'Efficiency_Adjusted_Gap_Reversal' (EAGR) factor, which simplified the original hybrid concept into a rank-based interaction between gap magnitude and volume efficiency, outperformed the previous SOTA across almost all key metrics. Specifically, the Information Ratio increased from 0.97 to 1.25, and the Annualized Return nearly doubled from 5.2% to 9.1%. While the Max Drawdown increased slightly, the substantial gain in IC (0.0058 to 0.0081) suggests a much stronger signal-to-noise ratio. The move from raw Z-scores to rank-based transformations appears to have mitigated outlier sensitivity and improved cross-sectional comparability.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that the interaction between overnight gaps and volume efficiency (range-to-volume ratio) captures meaningful market turning points. The 'Exhaustion' component (low volume efficiency relative to range) effectively filters the 'Momentum' component (gap size). The transition from the 'Inst_Exhaustion_Momentum_Hybrid' formulation to the 'Efficiency_Adjusted_Gap_Reversal' suggests that capturing the relative position (RANK) of these features is more robust than using raw Z-scores and means, likely because it normalizes for varying volatility regimes across different instruments.",
        "decision": true,
        "reason": "While the current rank-based approach is successful, it treats all volume efficiency levels linearly. In market microstructure, exhaustion is typically an extreme event. By focusing on the interaction between the current gap and the 3-day volume acceleration (using a ratio of short-term to long-term volume), we can better isolate 'climax' events from 'breakaway' events. Additionally, simplifying the denominator to a 3-day window for the gap scaling may capture more immediate price pressure."
      },
      "cache_location": null
    },
    "b251ccd73a5e6e35": {
      "factor_id": "b251ccd73a5e6e35",
      "factor_name": "Efficiency_Adjusted_Gap_Reversal",
      "factor_expression": "RANK(($open - DELAY($close, 1)) / ($high - $low + 1e-8)) * TS_RANK(($high - $low) / ($volume + 1e-8), 20)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(($open - DELAY($close, 1)) / ($high - $low + 1e-8)) * TS_RANK(($high - $low) / ($volume + 1e-8), 20)\" # Your output factor expression will be filled in here\n    name = \"Efficiency_Adjusted_Gap_Reversal\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A simplified version of the institutional exhaustion hypothesis focusing on the cross-sectional rank of the gap magnitude relative to its intraday range, adjusted by the time-series rank of volume efficiency to capture liquidity-driven reversals.",
      "factor_formulation": "\\text{EAGR} = \\text{RANK}\\left(\\frac{\\text{open} - \\text{delay}(\\text{close}, 1)}{\\text{high} - \\text{low} + 1e-8}\\right) \\times \\text{TS\\_RANK}\\left(\\frac{\\text{high} - \\text{low}}{\\text{volume} + 1e-8}, 20\\right)",
      "metadata": {
        "experiment_id": "2026-01-18_23-34-31-850258",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "f2e95768825b",
        "parent_trajectory_ids": [
          "492e236353d7",
          "c7a40ae95b51"
        ],
        "hypothesis": "Hypothesis: The 'Institutional Exhaustion-Momentum Hybrid' factor identifies market turning points by calculating the ratio of the overnight gap to the 5-day volume-weighted intraday range, then scaling this by the 20-day Z-score of volume efficiency (range-to-volume ratio) to distinguish between breakaway momentum and climax exhaustion.\n                Concise Observation: Parent 1 (RankIC=0.0239) succeeds in identifying reversals through liquidity exhaustion, while Parent 2 (RankIC=0.0249) captures momentum from structural shocks; however, both struggle to distinguish between 'climax' volume and 'breakout' volume without cross-temporal normalization.\n                Concise Justification: By normalizing the overnight gap with the intraday range and weighting it by the 20-day relative volume efficiency, the factor captures the 'cost' of price movement, where high-cost gaps (high volume/low range) signal institutional exhaustion and low-cost gaps signal sustainable trends.\n                Concise Knowledge: If an overnight price gap is accompanied by high volume but low intraday price extension (low volume efficiency), it signifies liquidity exhaustion and a likely reversal; conversely, if a gap occurs with high volume efficiency, it indicates a structural momentum shift.\n                concise Specification: The factor is defined as (Overnight Gap / 5-day Moving Average of Intraday Range) multiplied by the 20-day Z-score of (Intraday Range / Volume). The overnight gap is ($open - $close[1]) / $close[1], and the intraday range is ($high - $low) / $close.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T13:26:03.523396"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1187984923827096,
        "ICIR": 0.0582824746554352,
        "1day.excess_return_without_cost.std": 0.0047129371901752,
        "1day.excess_return_with_cost.annualized_return": 0.043837728495333,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003823870846335,
        "1day.excess_return_without_cost.annualized_return": 0.0910081261427928,
        "1day.excess_return_with_cost.std": 0.0047136457506271,
        "Rank IC": 0.0285424697769071,
        "IC": 0.0081112328559831,
        "1day.excess_return_without_cost.max_drawdown": -0.0990788570418628,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.2516993937928804,
        "1day.pa": 0.0,
        "l2.valid": 0.9965540688366494,
        "Rank ICIR": 0.2044980149725562,
        "l2.train": 0.9940511320749748,
        "1day.excess_return_with_cost.information_ratio": 0.6028407807048954,
        "1day.excess_return_with_cost.mean": 0.000184192136535
      },
      "feedback": {
        "observations": "The experiment results demonstrate a significant improvement in predictive performance. The 'Efficiency_Adjusted_Gap_Reversal' (EAGR) factor, which simplified the original hybrid concept into a rank-based interaction between gap magnitude and volume efficiency, outperformed the previous SOTA across almost all key metrics. Specifically, the Information Ratio increased from 0.97 to 1.25, and the Annualized Return nearly doubled from 5.2% to 9.1%. While the Max Drawdown increased slightly, the substantial gain in IC (0.0058 to 0.0081) suggests a much stronger signal-to-noise ratio. The move from raw Z-scores to rank-based transformations appears to have mitigated outlier sensitivity and improved cross-sectional comparability.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that the interaction between overnight gaps and volume efficiency (range-to-volume ratio) captures meaningful market turning points. The 'Exhaustion' component (low volume efficiency relative to range) effectively filters the 'Momentum' component (gap size). The transition from the 'Inst_Exhaustion_Momentum_Hybrid' formulation to the 'Efficiency_Adjusted_Gap_Reversal' suggests that capturing the relative position (RANK) of these features is more robust than using raw Z-scores and means, likely because it normalizes for varying volatility regimes across different instruments.",
        "decision": true,
        "reason": "While the current rank-based approach is successful, it treats all volume efficiency levels linearly. In market microstructure, exhaustion is typically an extreme event. By focusing on the interaction between the current gap and the 3-day volume acceleration (using a ratio of short-term to long-term volume), we can better isolate 'climax' events from 'breakaway' events. Additionally, simplifying the denominator to a 3-day window for the gap scaling may capture more immediate price pressure."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_213430",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_213430",
        "factor_dir": "bbce92fec1a445deb0eecce674ccd832",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_213430/bbce92fec1a445deb0eecce674ccd832/result.h5"
      }
    },
    "f9c7c55e7a8548fc": {
      "factor_id": "f9c7c55e7a8548fc",
      "factor_name": "Inst_Shock_Inertia_20D",
      "factor_expression": "(TS_MEAN(($open - DELAY($close, 1)) / (DELAY($close, 1) + 1e-8), 20) / (TS_STD(($close - $open) / ($open + 1e-8), 20) + 1e-8)) * TS_CORR($close, $volume, 20)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"(TS_MEAN(($open - DELAY($close, 1)) / (DELAY($close, 1) + 1e-8), 20) / (TS_STD(($close - $open) / ($open + 1e-8), 20) + 1e-8)) * TS_CORR($close, $volume, 20)\" # Your output factor expression will be filled in here\n    name = \"Inst_Shock_Inertia_20D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor identifies high-conviction reversals by combining institutional accumulation (overnight gaps) with price-volume exhaustion. It normalizes the 20-day average overnight return by intraday volatility and multiplies it by the 20-day price-volume correlation to filter mean-reversion signals with institutional confirmation.",
      "factor_formulation": "\\text{ISI}_{20D} = \\left( \\frac{\\text{TS\\_MEAN}(\\frac{open - \\text{DELAY}(close, 1)}{\\text{DELAY}(close, 1)}, 20)}{\\text{TS\\_STD}(\\frac{close - open}{open}, 20) + 1e-8} \\right) \\times \\text{TS\\_CORR}(close, volume, 20)",
      "metadata": {
        "experiment_id": "2026-01-19_04-13-15-519909",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "204f77ff6819",
        "parent_trajectory_ids": [
          "29bacf7b4535",
          "18113f7195f3"
        ],
        "hypothesis": "Hypothesis: The Institutional Shock-Inertia Factor, calculated as the product of the 20-day average overnight return normalized by intraday volatility and the 20-day price-volume correlation, identifies high-conviction reversals where institutional positioning aligns with price-volume exhaustion.\n                Concise Observation: Parent 1 (RankIC 0.030) captures institutional accumulation through overnight gaps, while Parent 2 (RankIC 0.025) identifies mean-reversion via price-volume dynamics; combining them addresses the 'falling knife' risk by requiring institutional confirmation for reversal trades.\n                Concise Justification: The factor fuses 'Information Inertia' (institutional backing) with 'Capitulation Shocks' (retail exhaustion) to filter out noise, ensuring that mean-reversion entries are supported by a consistent underlying information flow rather than random volatility.\n                Concise Knowledge: If overnight returns show consistent directional inertia while price-volume correlation indicates trend exhaustion, then the resulting signal identifies high-probability 'Smart Money' reversals; when institutional flow stabilizes a price shock, the predictive power of the mean-reversion signal increases.\n                concise Specification: Define the factor as (Mean(Overnight_Return, 20) / Std(Intraday_Return, 20)) * Corr(Close, Volume, 20), where Overnight_Return is (Open - Prev_Close) / Prev_Close and Intraday_Return is (Close - Open) / Open.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T15:34:28.354302"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.105567407384848,
        "ICIR": 0.0667963777351777,
        "1day.excess_return_without_cost.std": 0.0047138589038081,
        "1day.excess_return_with_cost.annualized_return": 0.0515866523107445,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0004166568961882,
        "1day.excess_return_without_cost.annualized_return": 0.0991643412927921,
        "1day.excess_return_with_cost.std": 0.0047148534367237,
        "Rank IC": 0.0280147283190491,
        "IC": 0.0096917804735918,
        "1day.excess_return_without_cost.max_drawdown": -0.0936940240699886,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.3636109306890054,
        "1day.pa": 0.0,
        "l2.valid": 0.9968641271386974,
        "Rank ICIR": 0.1968737588484816,
        "l2.train": 0.9942394400514534,
        "1day.excess_return_with_cost.information_ratio": 0.7092195030488795,
        "1day.excess_return_with_cost.mean": 0.0002167506399611
      },
      "feedback": {
        "observations": "The current iteration demonstrates a significant performance leap over the previous SOTA. The Information Ratio (IR) increased from 0.97 to 1.36, and the Annualized Return nearly doubled from 5.2% to 9.9%. The Information Coefficient (IC) also showed a robust improvement to 0.0097. While the Max Drawdown slightly deepened (-0.093 vs -0.072), the risk-adjusted return profile (IR) is substantially superior. The success appears to stem from the interaction between institutional overnight signals and price-volume correlation, particularly when using cross-sectional ranking or shorter-term volatility adjustments.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that institutional 'shocks' (overnight gaps) combined with 'inertia' (price-volume correlation) provide high-conviction signals. Specifically, the 'Ranked_Inst_Reversal_20D' and 'Vol_Adjusted_Inertia_Reversal_10D' variations suggest that the signal is more effective when normalized cross-sectionally or when using the intraday range (high-low) as a denominator for volatility, rather than just standard deviation of returns.",
        "decision": true,
        "reason": "The current success of VAIR_10D suggests that the 'High-Low' range is a more effective normalizer for institutional gaps than standard deviation. By adding a volume-trend component (Volume / TS_MEAN(Volume, n)), we can distinguish between 'exhaustion' (high correlation, high volume) and 'indifference' (high correlation, low volume), further refining the 'inertia' part of the original hypothesis. A 10-15 day window seems optimal for capturing these mean-reversion dynamics."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221443",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221443",
        "factor_dir": "ab542974248049e283fa3007ec319afb",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221443/ab542974248049e283fa3007ec319afb/result.h5"
      }
    },
    "0770ef370f5ed9ff": {
      "factor_id": "0770ef370f5ed9ff",
      "factor_name": "Ranked_Inst_Reversal_20D",
      "factor_expression": "RANK(TS_MEAN(($open - DELAY($close, 1)) / (DELAY($close, 1) + 1e-8), 20)) * RANK(TS_CORR($close, $volume, 20))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(TS_MEAN(($open - DELAY($close, 1)) / (DELAY($close, 1) + 1e-8), 20)) * RANK(TS_CORR($close, $volume, 20))\" # Your output factor expression will be filled in here\n    name = \"Ranked_Inst_Reversal_20D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A cross-sectionally ranked version of the Institutional Shock-Inertia hypothesis. It captures the relative strength of institutional overnight positioning against the exhaustion of the current price-volume trend, improving comparability across different stocks.",
      "factor_formulation": "\\text{RIR}_{20D} = \\text{RANK}(\\text{TS\\_MEAN}(\\text{Overnight\\_Ret}, 20)) \\times \\text{RANK}(\\text{TS\\_CORR}(close, volume, 20))",
      "metadata": {
        "experiment_id": "2026-01-19_04-13-15-519909",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "204f77ff6819",
        "parent_trajectory_ids": [
          "29bacf7b4535",
          "18113f7195f3"
        ],
        "hypothesis": "Hypothesis: The Institutional Shock-Inertia Factor, calculated as the product of the 20-day average overnight return normalized by intraday volatility and the 20-day price-volume correlation, identifies high-conviction reversals where institutional positioning aligns with price-volume exhaustion.\n                Concise Observation: Parent 1 (RankIC 0.030) captures institutional accumulation through overnight gaps, while Parent 2 (RankIC 0.025) identifies mean-reversion via price-volume dynamics; combining them addresses the 'falling knife' risk by requiring institutional confirmation for reversal trades.\n                Concise Justification: The factor fuses 'Information Inertia' (institutional backing) with 'Capitulation Shocks' (retail exhaustion) to filter out noise, ensuring that mean-reversion entries are supported by a consistent underlying information flow rather than random volatility.\n                Concise Knowledge: If overnight returns show consistent directional inertia while price-volume correlation indicates trend exhaustion, then the resulting signal identifies high-probability 'Smart Money' reversals; when institutional flow stabilizes a price shock, the predictive power of the mean-reversion signal increases.\n                concise Specification: Define the factor as (Mean(Overnight_Return, 20) / Std(Intraday_Return, 20)) * Corr(Close, Volume, 20), where Overnight_Return is (Open - Prev_Close) / Prev_Close and Intraday_Return is (Close - Open) / Open.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T15:34:28.354302"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.105567407384848,
        "ICIR": 0.0667963777351777,
        "1day.excess_return_without_cost.std": 0.0047138589038081,
        "1day.excess_return_with_cost.annualized_return": 0.0515866523107445,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0004166568961882,
        "1day.excess_return_without_cost.annualized_return": 0.0991643412927921,
        "1day.excess_return_with_cost.std": 0.0047148534367237,
        "Rank IC": 0.0280147283190491,
        "IC": 0.0096917804735918,
        "1day.excess_return_without_cost.max_drawdown": -0.0936940240699886,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.3636109306890054,
        "1day.pa": 0.0,
        "l2.valid": 0.9968641271386974,
        "Rank ICIR": 0.1968737588484816,
        "l2.train": 0.9942394400514534,
        "1day.excess_return_with_cost.information_ratio": 0.7092195030488795,
        "1day.excess_return_with_cost.mean": 0.0002167506399611
      },
      "feedback": {
        "observations": "The current iteration demonstrates a significant performance leap over the previous SOTA. The Information Ratio (IR) increased from 0.97 to 1.36, and the Annualized Return nearly doubled from 5.2% to 9.9%. The Information Coefficient (IC) also showed a robust improvement to 0.0097. While the Max Drawdown slightly deepened (-0.093 vs -0.072), the risk-adjusted return profile (IR) is substantially superior. The success appears to stem from the interaction between institutional overnight signals and price-volume correlation, particularly when using cross-sectional ranking or shorter-term volatility adjustments.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that institutional 'shocks' (overnight gaps) combined with 'inertia' (price-volume correlation) provide high-conviction signals. Specifically, the 'Ranked_Inst_Reversal_20D' and 'Vol_Adjusted_Inertia_Reversal_10D' variations suggest that the signal is more effective when normalized cross-sectionally or when using the intraday range (high-low) as a denominator for volatility, rather than just standard deviation of returns.",
        "decision": true,
        "reason": "The current success of VAIR_10D suggests that the 'High-Low' range is a more effective normalizer for institutional gaps than standard deviation. By adding a volume-trend component (Volume / TS_MEAN(Volume, n)), we can distinguish between 'exhaustion' (high correlation, high volume) and 'indifference' (high correlation, low volume), further refining the 'inertia' part of the original hypothesis. A 10-15 day window seems optimal for capturing these mean-reversion dynamics."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221443",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221443",
        "factor_dir": "6b8e9f5229744b2598d18a6970063205",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221443/6b8e9f5229744b2598d18a6970063205/result.h5"
      }
    },
    "dc861be44b8a6214": {
      "factor_id": "dc861be44b8a6214",
      "factor_name": "Vol_Adjusted_Inertia_Reversal_10D",
      "factor_expression": "TS_MEAN(($open - DELAY($close, 1)) / ($high - $low + 1e-8), 10) * TS_CORR($return, $volume, 10)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"TS_MEAN(($open - DELAY($close, 1)) / ($high - $low + 1e-8), 10) * TS_CORR(TS_PCTCHANGE($close, 1), $volume, 10)\" # Your output factor expression will be filled in here\n    name = \"Vol_Adjusted_Inertia_Reversal_10D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A variation of the Institutional Shock-Inertia factor focusing on a shorter 10-day window to capture faster mean-reversion opportunities. It uses the ratio of overnight return to intraday range as a proxy for institutional conviction versus retail volatility.",
      "factor_formulation": "\\text{VAIR}_{10D} = \\text{TS\\_MEAN}\\left(\\frac{open - \\text{DELAY}(close, 1)}{high - low + 1e-8}, 10\\right) \\times \\text{TS\\_CORR}(return, volume, 10)",
      "metadata": {
        "experiment_id": "2026-01-19_04-13-15-519909",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "204f77ff6819",
        "parent_trajectory_ids": [
          "29bacf7b4535",
          "18113f7195f3"
        ],
        "hypothesis": "Hypothesis: The Institutional Shock-Inertia Factor, calculated as the product of the 20-day average overnight return normalized by intraday volatility and the 20-day price-volume correlation, identifies high-conviction reversals where institutional positioning aligns with price-volume exhaustion.\n                Concise Observation: Parent 1 (RankIC 0.030) captures institutional accumulation through overnight gaps, while Parent 2 (RankIC 0.025) identifies mean-reversion via price-volume dynamics; combining them addresses the 'falling knife' risk by requiring institutional confirmation for reversal trades.\n                Concise Justification: The factor fuses 'Information Inertia' (institutional backing) with 'Capitulation Shocks' (retail exhaustion) to filter out noise, ensuring that mean-reversion entries are supported by a consistent underlying information flow rather than random volatility.\n                Concise Knowledge: If overnight returns show consistent directional inertia while price-volume correlation indicates trend exhaustion, then the resulting signal identifies high-probability 'Smart Money' reversals; when institutional flow stabilizes a price shock, the predictive power of the mean-reversion signal increases.\n                concise Specification: Define the factor as (Mean(Overnight_Return, 20) / Std(Intraday_Return, 20)) * Corr(Close, Volume, 20), where Overnight_Return is (Open - Prev_Close) / Prev_Close and Intraday_Return is (Close - Open) / Open.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T15:34:28.354302"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.105567407384848,
        "ICIR": 0.0667963777351777,
        "1day.excess_return_without_cost.std": 0.0047138589038081,
        "1day.excess_return_with_cost.annualized_return": 0.0515866523107445,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0004166568961882,
        "1day.excess_return_without_cost.annualized_return": 0.0991643412927921,
        "1day.excess_return_with_cost.std": 0.0047148534367237,
        "Rank IC": 0.0280147283190491,
        "IC": 0.0096917804735918,
        "1day.excess_return_without_cost.max_drawdown": -0.0936940240699886,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.3636109306890054,
        "1day.pa": 0.0,
        "l2.valid": 0.9968641271386974,
        "Rank ICIR": 0.1968737588484816,
        "l2.train": 0.9942394400514534,
        "1day.excess_return_with_cost.information_ratio": 0.7092195030488795,
        "1day.excess_return_with_cost.mean": 0.0002167506399611
      },
      "feedback": {
        "observations": "The current iteration demonstrates a significant performance leap over the previous SOTA. The Information Ratio (IR) increased from 0.97 to 1.36, and the Annualized Return nearly doubled from 5.2% to 9.9%. The Information Coefficient (IC) also showed a robust improvement to 0.0097. While the Max Drawdown slightly deepened (-0.093 vs -0.072), the risk-adjusted return profile (IR) is substantially superior. The success appears to stem from the interaction between institutional overnight signals and price-volume correlation, particularly when using cross-sectional ranking or shorter-term volatility adjustments.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that institutional 'shocks' (overnight gaps) combined with 'inertia' (price-volume correlation) provide high-conviction signals. Specifically, the 'Ranked_Inst_Reversal_20D' and 'Vol_Adjusted_Inertia_Reversal_10D' variations suggest that the signal is more effective when normalized cross-sectionally or when using the intraday range (high-low) as a denominator for volatility, rather than just standard deviation of returns.",
        "decision": true,
        "reason": "The current success of VAIR_10D suggests that the 'High-Low' range is a more effective normalizer for institutional gaps than standard deviation. By adding a volume-trend component (Volume / TS_MEAN(Volume, n)), we can distinguish between 'exhaustion' (high correlation, high volume) and 'indifference' (high correlation, low volume), further refining the 'inertia' part of the original hypothesis. A 10-15 day window seems optimal for capturing these mean-reversion dynamics."
      },
      "cache_location": null
    },
    "54c9d320daecda99": {
      "factor_id": "54c9d320daecda99",
      "factor_name": "ILVR_Exhaustion_Support_Ratio_5_20",
      "factor_expression": "TS_MEAN(($high - $low) / ($close + 1e-8), 5) / (TS_MEAN($volume, 5) + 1e-8) / (PERCENTILE($low / ($open + 1e-8), 0.95, 20) + 1e-8)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"TS_MEAN(($high - $low) / ($close + 1e-8), 5) / (TS_MEAN($volume, 5) + 1e-8) / (PERCENTILE($low / ($open + 1e-8), 0.95, 20) + 1e-8)\" # Your output factor expression will be filled in here\n    name = \"ILVR_Exhaustion_Support_Ratio_5_20\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "The Institutional Liquidity Vacuum Reversal (ILVR) factor identifies mean-reversion points by calculating the ratio of short-term (5-day) price-range-to-volume exhaustion to the long-term (20-day) institutional support level. High values indicate price overextension relative to a structural floor, suggesting an impending reversal.",
      "factor_formulation": "\\frac{\\text{TS_MEAN}(\\frac{\\text{high} - \\text{low}}{\\text{close}}, 5) / (\\text{TS_MEAN}(\\text{volume}, 5) + 1e-8)}{\\text{PERCENTILE}(\\frac{\\text{low}}{\\text{open}}, 0.95, 20)}",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "f77f98558c8f",
        "parent_trajectory_ids": [
          "e95a3b61464b",
          "7329054553ab"
        ],
        "hypothesis": "Hypothesis: The Institutional Liquidity Vacuum Reversal (ILVR) factor, defined as the ratio of 5-day price-range-to-turnover exhaustion to the 20-day institutional support level (95th percentile of Low/Open), identifies high-probability mean-reversion points where price overextension meets a structural floor.\n                Concise Observation: Parent 1 (RankIC 0.022) captures price-volume divergence but suffers from 'falling knife' risks, while Parent 2 (RankIC 0.031) identifies support but lacks a timing trigger; combining short-term exhaustion with long-term support metrics addresses these individual weaknesses.\n                Concise Justification: The 'Liquidity Vacuum' occurs when sellers are exhausted (high range/volume) but buyers maintain a hard floor (high Low/Open ratio), suggesting that any marginal buying pressure will cause a rapid price recovery due to the lack of liquidity on the offer side.\n                Concise Knowledge: If a stock exhibits high price volatility relative to its trading volume (liquidity exhaustion) while maintaining a high intraday price floor (institutional support), then it is likely to undergo a sharp price reversal; When short-term capitulation occurs above long-term support, the probability of a mean-reversion bounce increases.\n                concise Specification: The factor is calculated as (RollingRange(5)/RollingTurnover(5)) divided by (Percentile(Low/Open, 20, 0.95)), where RollingRange is (High-Low)/Close; it expects a positive correlation with future returns as higher values indicate more significant exhaustion relative to support.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T08:58:04.995687"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.0724102848345958,
        "ICIR": 0.0524864846144177,
        "1day.excess_return_without_cost.std": 0.0043582745740478,
        "1day.excess_return_with_cost.annualized_return": 0.0442615748458996,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003831452468833,
        "1day.excess_return_without_cost.annualized_return": 0.0911885687582476,
        "1day.excess_return_with_cost.std": 0.004358253441992,
        "Rank IC": 0.0274241300739491,
        "IC": 0.0074304894325682,
        "1day.excess_return_without_cost.max_drawdown": -0.0641610285573758,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.356242448937553,
        "1day.pa": 0.0,
        "l2.valid": 0.9966116618747282,
        "Rank ICIR": 0.1957133705753443,
        "l2.train": 0.9934653983155316,
        "1day.excess_return_with_cost.information_ratio": 0.6583031025446957,
        "1day.excess_return_with_cost.mean": 0.0001859730035542
      },
      "feedback": {
        "observations": "The experimental results for the Institutional Liquidity Vacuum Reversal (ILVR) framework show a significant improvement across all key performance metrics compared to the previous SOTA. Specifically, the Information Ratio (IR) increased from 0.97 to 1.35, and the Annualized Return rose from 5.2% to 9.1%. The IC also improved from 0.0058 to 0.0074, while the Max Drawdown was reduced. Among the tested factors, the transition from raw ratios to Z-scored exhaustion (ILVR_Zscore_Capitulation_20D) and ranked interactions appears to have successfully captured the 'vacuum' effect by normalizing price-range-to-volume dynamics against historical volatility.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that identifying points where price exhaustion (range/volume) meets a structural floor (95th percentile of Low/Open) yields high-probability reversal signals. The Z-score implementation (ILVR_Zscore_Capitulation_20D) is particularly effective because it identifies 'statistical extremes' in exhaustion rather than just high absolute values, which helps in filtering out high-volatility regimes that are not necessarily reversals.",
        "decision": true,
        "reason": "While the current ILVR identifies range/volume exhaustion, it doesn't distinguish if the volume is supporting the floor or accelerating the break. By integrating a 'Volume Force' component (e.g., the ratio of volume on down-days vs up-days within the 5-day window), we can isolate true capitulation events where selling pressure is exhausted at the institutional support level, thereby increasing the precision of the mean-reversion signal."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221528",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528",
        "factor_dir": "e7dc1df22a174fae98a5875918b2d284",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528/e7dc1df22a174fae98a5875918b2d284/result.h5"
      }
    },
    "bd9cc5bd659b3ed6": {
      "factor_id": "bd9cc5bd659b3ed6",
      "factor_name": "ILVR_Ranked_Exhaustion_Support_10D",
      "factor_expression": "RANK(TS_MEAN(($high - $low) / ($close + 1e-8), 10) / (TS_MEAN($volume, 10) + 1e-8)) * RANK(PERCENTILE($low / ($open + 1e-8), 0.95, 10))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(TS_MEAN(($high - $low) / ($close + 1e-8), 10) / (TS_MEAN($volume, 10) + 1e-8)) * RANK(PERCENTILE($low / ($open + 1e-8), 0.95, 10))\" # Your output factor expression will be filled in here\n    name = \"ILVR_Ranked_Exhaustion_Support_10D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A cross-sectionally ranked version of the ILVR hypothesis, focusing on the 10-day window for both exhaustion and support. It measures the intensity of price range expansion relative to volume, normalized by the stability of the intraday low-to-open ratio.",
      "factor_formulation": "\\text{RANK}(\\frac{\\text{TS_MEAN}(\\frac{\\text{high} - \\text{low}}{\\text{close}}, 10)}{\\text{TS_MEAN}(\\text{volume}, 10) + 1e-8}) * \\text{RANK}(\\text{PERCENTILE}(\\frac{\\text{low}}{\\text{open}}, 0.95, 10))",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "f77f98558c8f",
        "parent_trajectory_ids": [
          "e95a3b61464b",
          "7329054553ab"
        ],
        "hypothesis": "Hypothesis: The Institutional Liquidity Vacuum Reversal (ILVR) factor, defined as the ratio of 5-day price-range-to-turnover exhaustion to the 20-day institutional support level (95th percentile of Low/Open), identifies high-probability mean-reversion points where price overextension meets a structural floor.\n                Concise Observation: Parent 1 (RankIC 0.022) captures price-volume divergence but suffers from 'falling knife' risks, while Parent 2 (RankIC 0.031) identifies support but lacks a timing trigger; combining short-term exhaustion with long-term support metrics addresses these individual weaknesses.\n                Concise Justification: The 'Liquidity Vacuum' occurs when sellers are exhausted (high range/volume) but buyers maintain a hard floor (high Low/Open ratio), suggesting that any marginal buying pressure will cause a rapid price recovery due to the lack of liquidity on the offer side.\n                Concise Knowledge: If a stock exhibits high price volatility relative to its trading volume (liquidity exhaustion) while maintaining a high intraday price floor (institutional support), then it is likely to undergo a sharp price reversal; When short-term capitulation occurs above long-term support, the probability of a mean-reversion bounce increases.\n                concise Specification: The factor is calculated as (RollingRange(5)/RollingTurnover(5)) divided by (Percentile(Low/Open, 20, 0.95)), where RollingRange is (High-Low)/Close; it expects a positive correlation with future returns as higher values indicate more significant exhaustion relative to support.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T08:58:04.995687"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.0724102848345958,
        "ICIR": 0.0524864846144177,
        "1day.excess_return_without_cost.std": 0.0043582745740478,
        "1day.excess_return_with_cost.annualized_return": 0.0442615748458996,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003831452468833,
        "1day.excess_return_without_cost.annualized_return": 0.0911885687582476,
        "1day.excess_return_with_cost.std": 0.004358253441992,
        "Rank IC": 0.0274241300739491,
        "IC": 0.0074304894325682,
        "1day.excess_return_without_cost.max_drawdown": -0.0641610285573758,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.356242448937553,
        "1day.pa": 0.0,
        "l2.valid": 0.9966116618747282,
        "Rank ICIR": 0.1957133705753443,
        "l2.train": 0.9934653983155316,
        "1day.excess_return_with_cost.information_ratio": 0.6583031025446957,
        "1day.excess_return_with_cost.mean": 0.0001859730035542
      },
      "feedback": {
        "observations": "The experimental results for the Institutional Liquidity Vacuum Reversal (ILVR) framework show a significant improvement across all key performance metrics compared to the previous SOTA. Specifically, the Information Ratio (IR) increased from 0.97 to 1.35, and the Annualized Return rose from 5.2% to 9.1%. The IC also improved from 0.0058 to 0.0074, while the Max Drawdown was reduced. Among the tested factors, the transition from raw ratios to Z-scored exhaustion (ILVR_Zscore_Capitulation_20D) and ranked interactions appears to have successfully captured the 'vacuum' effect by normalizing price-range-to-volume dynamics against historical volatility.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that identifying points where price exhaustion (range/volume) meets a structural floor (95th percentile of Low/Open) yields high-probability reversal signals. The Z-score implementation (ILVR_Zscore_Capitulation_20D) is particularly effective because it identifies 'statistical extremes' in exhaustion rather than just high absolute values, which helps in filtering out high-volatility regimes that are not necessarily reversals.",
        "decision": true,
        "reason": "While the current ILVR identifies range/volume exhaustion, it doesn't distinguish if the volume is supporting the floor or accelerating the break. By integrating a 'Volume Force' component (e.g., the ratio of volume on down-days vs up-days within the 5-day window), we can isolate true capitulation events where selling pressure is exhausted at the institutional support level, thereby increasing the precision of the mean-reversion signal."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221528",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528",
        "factor_dir": "41494e20839241a28104e00b6f77f228",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528/41494e20839241a28104e00b6f77f228/result.h5"
      }
    },
    "1684eef7459522f4": {
      "factor_id": "1684eef7459522f4",
      "factor_name": "ILVR_Zscore_Capitulation_20D",
      "factor_expression": "TS_ZSCORE(($high - $low) / ($volume + 1e-8), 20) / (PERCENTILE($low / ($open + 1e-8), 0.95, 20) + 1e-8)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"TS_ZSCORE(($high - $low) / ($volume + 1e-8), 20) / (PERCENTILE($low / ($open + 1e-8), 0.95, 20) + 1e-8)\" # Your output factor expression will be filled in here\n    name = \"ILVR_Zscore_Capitulation_20D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor uses Z-scores to identify extreme price exhaustion (range/volume) relative to the institutional support floor. It highlights stocks where the current exhaustion is significantly higher than its recent history while the support floor remains robust.",
      "factor_formulation": "\\text{TS_ZSCORE}(\\frac{\\text{high} - \\text{low}}{\\text{volume} + 1e-8}, 20) / (\\text{PERCENTILE}(\\frac{\\text{low}}{\\text{open}}, 0.95, 20) + 1e-8)",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "f77f98558c8f",
        "parent_trajectory_ids": [
          "e95a3b61464b",
          "7329054553ab"
        ],
        "hypothesis": "Hypothesis: The Institutional Liquidity Vacuum Reversal (ILVR) factor, defined as the ratio of 5-day price-range-to-turnover exhaustion to the 20-day institutional support level (95th percentile of Low/Open), identifies high-probability mean-reversion points where price overextension meets a structural floor.\n                Concise Observation: Parent 1 (RankIC 0.022) captures price-volume divergence but suffers from 'falling knife' risks, while Parent 2 (RankIC 0.031) identifies support but lacks a timing trigger; combining short-term exhaustion with long-term support metrics addresses these individual weaknesses.\n                Concise Justification: The 'Liquidity Vacuum' occurs when sellers are exhausted (high range/volume) but buyers maintain a hard floor (high Low/Open ratio), suggesting that any marginal buying pressure will cause a rapid price recovery due to the lack of liquidity on the offer side.\n                Concise Knowledge: If a stock exhibits high price volatility relative to its trading volume (liquidity exhaustion) while maintaining a high intraday price floor (institutional support), then it is likely to undergo a sharp price reversal; When short-term capitulation occurs above long-term support, the probability of a mean-reversion bounce increases.\n                concise Specification: The factor is calculated as (RollingRange(5)/RollingTurnover(5)) divided by (Percentile(Low/Open, 20, 0.95)), where RollingRange is (High-Low)/Close; it expects a positive correlation with future returns as higher values indicate more significant exhaustion relative to support.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T08:58:04.995687"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.0724102848345958,
        "ICIR": 0.0524864846144177,
        "1day.excess_return_without_cost.std": 0.0043582745740478,
        "1day.excess_return_with_cost.annualized_return": 0.0442615748458996,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003831452468833,
        "1day.excess_return_without_cost.annualized_return": 0.0911885687582476,
        "1day.excess_return_with_cost.std": 0.004358253441992,
        "Rank IC": 0.0274241300739491,
        "IC": 0.0074304894325682,
        "1day.excess_return_without_cost.max_drawdown": -0.0641610285573758,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.356242448937553,
        "1day.pa": 0.0,
        "l2.valid": 0.9966116618747282,
        "Rank ICIR": 0.1957133705753443,
        "l2.train": 0.9934653983155316,
        "1day.excess_return_with_cost.information_ratio": 0.6583031025446957,
        "1day.excess_return_with_cost.mean": 0.0001859730035542
      },
      "feedback": {
        "observations": "The experimental results for the Institutional Liquidity Vacuum Reversal (ILVR) framework show a significant improvement across all key performance metrics compared to the previous SOTA. Specifically, the Information Ratio (IR) increased from 0.97 to 1.35, and the Annualized Return rose from 5.2% to 9.1%. The IC also improved from 0.0058 to 0.0074, while the Max Drawdown was reduced. Among the tested factors, the transition from raw ratios to Z-scored exhaustion (ILVR_Zscore_Capitulation_20D) and ranked interactions appears to have successfully captured the 'vacuum' effect by normalizing price-range-to-volume dynamics against historical volatility.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that identifying points where price exhaustion (range/volume) meets a structural floor (95th percentile of Low/Open) yields high-probability reversal signals. The Z-score implementation (ILVR_Zscore_Capitulation_20D) is particularly effective because it identifies 'statistical extremes' in exhaustion rather than just high absolute values, which helps in filtering out high-volatility regimes that are not necessarily reversals.",
        "decision": true,
        "reason": "While the current ILVR identifies range/volume exhaustion, it doesn't distinguish if the volume is supporting the floor or accelerating the break. By integrating a 'Volume Force' component (e.g., the ratio of volume on down-days vs up-days within the 5-day window), we can isolate true capitulation events where selling pressure is exhausted at the institutional support level, thereby increasing the precision of the mean-reversion signal."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221528",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528",
        "factor_dir": "f670752b06a84e878fa927a8e6efaeef",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528/f670752b06a84e878fa927a8e6efaeef/result.h5"
      }
    },
    "e7d504903bdbb2d0": {
      "factor_id": "e7d504903bdbb2d0",
      "factor_name": "Fragile_Trend_Exhaustion_10D",
      "factor_expression": "POW(TS_CORR($close, SEQUENCE(10), 10), 2) * TS_ZSCORE($volume / ($high - $low + 1e-6), 5)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"POW(TS_CORR($close, SEQUENCE(10), 10), 2) * TS_ZSCORE($volume / (($high - $low) > 0.0001 ? ($high - $low) : 0.0001), 5)\" # Your output factor expression will be filled in here\n    name = \"Fragile_Trend_Exhaustion_10D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor identifies potential price reversals by multiplying the linearity of the price trend (R-squared of price against time) with the recent intensity of volume relative to price range. High values suggest a 'hollow' trend where increasing volume is no longer efficiently moving the price, signaling exhaustion.",
      "factor_formulation": "\\text{POW}(\\text{TS_CORR}(\\text{close}, \\text{SEQUENCE}(10), 10), 2) \\times \\text{TS_ZSCORE}(\\frac{\\text{volume}}{\\text{high} - \\text{low} + 1e-6}, 5)",
      "metadata": {
        "experiment_id": "2026-01-18_23-34-31-850258",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "fb92d294f7b1",
        "parent_trajectory_ids": [
          "492e236353d7",
          "65524478b0e4"
        ],
        "hypothesis": "Hypothesis: The 'Fragile Trend Exhaustion' factor identifies imminent reversals by detecting periods where high price linearity (10-day R-squared) coincides with a peak in the volume-to-price-range ratio (Z-score), signaling that institutional urgency is no longer producing efficient price movement.\n                Concise Observation: Parent 1 showed that volume surges relative to price extension signal exhaustion (RankIC 0.0239), while Parent 2 showed that high trend efficiency without volume support is unsustainable (RankIC 0.0251).\n                Concise Justification: Combining R-squared (trend orderliness) with a volume-to-range Z-score allows us to distinguish between healthy trend continuation and institutional 'climax' events where high volume fails to push prices further due to hidden liquidity absorption.\n                Concise Knowledge: If a high-linearity trend is accompanied by an increasing volume-to-range ratio, it indicates 'hollow' price action where liquidity is being exhausted; such trends are prone to reversal as the marginal impact of volume on price diminishes.\n                concise Specification: The factor is calculated as the product of the 10-day price-time R-squared and the 5-day Z-score of the ratio ($volume / ($high - $low + 1e-6)), where higher values predict a negative return for the following period.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T13:19:29.497056"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.0874486949749601,
        "ICIR": 0.0564645834771815,
        "1day.excess_return_without_cost.std": 0.0042639184534908,
        "1day.excess_return_with_cost.annualized_return": 0.0164677775734017,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002662110002972,
        "1day.excess_return_without_cost.annualized_return": 0.0633582180707404,
        "1day.excess_return_with_cost.std": 0.0042647608834794,
        "Rank IC": 0.0254984465937458,
        "IC": 0.0076790104212653,
        "1day.excess_return_without_cost.max_drawdown": -0.0784557186502475,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.9631758514861204,
        "1day.pa": 0.0,
        "l2.valid": 0.9965829411895698,
        "Rank ICIR": 0.1908088946512743,
        "l2.train": 0.993774407663575,
        "1day.excess_return_with_cost.information_ratio": 0.2502948004202984,
        "1day.excess_return_with_cost.mean": 6.919234274538563e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of the 'Fragile Trend Exhaustion' hypothesis. The results show a significant improvement in IC (0.007679 vs 0.005798) and Annualized Return (0.063358 vs 0.052010) compared to the SOTA, although the Information Ratio and Max Drawdown slightly deteriorated. The interaction between price linearity (R-squared) and volume efficiency (volume/range) appears to be a valid predictor of short-term reversals. The 'Volume_Absorption_Reversal_Index' specifically leveraged different lookback periods (20-day for trend, 5-day for volume) which likely contributed to the improved capture of climax behavior.",
        "hypothesis_evaluation": "The hypothesis that high price linearity combined with volume-to-range peaks signals exhaustion is strongly supported by the increase in IC and Annualized Return. However, the slight increase in Max Drawdown suggests that while the signal is predictive, it may be volatile or prone to 'false climaxes' in strong trending markets. The use of TS_RANK and RANK in the second and third factors helped normalize the signals, making them more robust than the raw Z-score used in the first iteration.",
        "decision": true,
        "reason": "The current results prove that volume-to-range is a good proxy for absorption. By refining this to 'Price Displacement Efficiency' (ABS(Return)/Volume) and anchoring it to price extremes (distance from rolling highs/lows), we can better distinguish between a healthy trend continuation and a true exhaustion climax. Using a 10-day window for linearity provides a balance between responsiveness and stability, while the efficiency metric should be short-term (3-5 days) to catch the immediate 'churning' at the peak."
      },
      "cache_location": null
    },
    "44fe523614e4829e": {
      "factor_id": "44fe523614e4829e",
      "factor_name": "Trend_Efficiency_Climax_Factor",
      "factor_expression": "RANK(POW(TS_CORR($close, SEQUENCE(10), 10), 2)) + RANK(TS_ZSCORE($volume / ($high - $low + 1e-6), 10))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(POW(TS_CORR($close, SEQUENCE(10), 10), 2)) + RANK(TS_ZSCORE($volume / ($high - $low + 1e-6), 10))\" # Your output factor expression will be filled in here\n    name = \"Trend_Efficiency_Climax_Factor\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A simplified version of the exhaustion hypothesis focusing on the cross-sectional rank of trend linearity and volume-to-range efficiency. It captures the divergence where a highly ordered trend (high R-squared) meets an extreme spike in volume-to-range ratio, indicating institutional absorption and imminent reversal.",
      "factor_formulation": "\\text{RANK}(\\text{POW}(\\text{TS_CORR}(\\text{close}, \\text{SEQUENCE}(10), 10), 2)) + \\text{RANK}(\\text{TS_ZSCORE}(\\frac{\\text{volume}}{\\text{high} - \\text{low} + 1e-6}, 10))",
      "metadata": {
        "experiment_id": "2026-01-18_23-34-31-850258",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "fb92d294f7b1",
        "parent_trajectory_ids": [
          "492e236353d7",
          "65524478b0e4"
        ],
        "hypothesis": "Hypothesis: The 'Fragile Trend Exhaustion' factor identifies imminent reversals by detecting periods where high price linearity (10-day R-squared) coincides with a peak in the volume-to-price-range ratio (Z-score), signaling that institutional urgency is no longer producing efficient price movement.\n                Concise Observation: Parent 1 showed that volume surges relative to price extension signal exhaustion (RankIC 0.0239), while Parent 2 showed that high trend efficiency without volume support is unsustainable (RankIC 0.0251).\n                Concise Justification: Combining R-squared (trend orderliness) with a volume-to-range Z-score allows us to distinguish between healthy trend continuation and institutional 'climax' events where high volume fails to push prices further due to hidden liquidity absorption.\n                Concise Knowledge: If a high-linearity trend is accompanied by an increasing volume-to-range ratio, it indicates 'hollow' price action where liquidity is being exhausted; such trends are prone to reversal as the marginal impact of volume on price diminishes.\n                concise Specification: The factor is calculated as the product of the 10-day price-time R-squared and the 5-day Z-score of the ratio ($volume / ($high - $low + 1e-6)), where higher values predict a negative return for the following period.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T13:19:29.497056"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.0874486949749601,
        "ICIR": 0.0564645834771815,
        "1day.excess_return_without_cost.std": 0.0042639184534908,
        "1day.excess_return_with_cost.annualized_return": 0.0164677775734017,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002662110002972,
        "1day.excess_return_without_cost.annualized_return": 0.0633582180707404,
        "1day.excess_return_with_cost.std": 0.0042647608834794,
        "Rank IC": 0.0254984465937458,
        "IC": 0.0076790104212653,
        "1day.excess_return_without_cost.max_drawdown": -0.0784557186502475,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.9631758514861204,
        "1day.pa": 0.0,
        "l2.valid": 0.9965829411895698,
        "Rank ICIR": 0.1908088946512743,
        "l2.train": 0.993774407663575,
        "1day.excess_return_with_cost.information_ratio": 0.2502948004202984,
        "1day.excess_return_with_cost.mean": 6.919234274538563e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of the 'Fragile Trend Exhaustion' hypothesis. The results show a significant improvement in IC (0.007679 vs 0.005798) and Annualized Return (0.063358 vs 0.052010) compared to the SOTA, although the Information Ratio and Max Drawdown slightly deteriorated. The interaction between price linearity (R-squared) and volume efficiency (volume/range) appears to be a valid predictor of short-term reversals. The 'Volume_Absorption_Reversal_Index' specifically leveraged different lookback periods (20-day for trend, 5-day for volume) which likely contributed to the improved capture of climax behavior.",
        "hypothesis_evaluation": "The hypothesis that high price linearity combined with volume-to-range peaks signals exhaustion is strongly supported by the increase in IC and Annualized Return. However, the slight increase in Max Drawdown suggests that while the signal is predictive, it may be volatile or prone to 'false climaxes' in strong trending markets. The use of TS_RANK and RANK in the second and third factors helped normalize the signals, making them more robust than the raw Z-score used in the first iteration.",
        "decision": true,
        "reason": "The current results prove that volume-to-range is a good proxy for absorption. By refining this to 'Price Displacement Efficiency' (ABS(Return)/Volume) and anchoring it to price extremes (distance from rolling highs/lows), we can better distinguish between a healthy trend continuation and a true exhaustion climax. Using a 10-day window for linearity provides a balance between responsiveness and stability, while the efficiency metric should be short-term (3-5 days) to catch the immediate 'churning' at the peak."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_213430",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_213430",
        "factor_dir": "f8709e034be04ecc9d1ab4bb134d7660",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_213430/f8709e034be04ecc9d1ab4bb134d7660/result.h5"
      }
    },
    "a9d72dea240d7ce2": {
      "factor_id": "a9d72dea240d7ce2",
      "factor_name": "Volume_Absorption_Reversal_Index",
      "factor_expression": "TS_RANK(POW(TS_CORR($close, SEQUENCE(20), 20), 2), 10) * TS_RANK($volume / ($high - $low + 1e-6), 5)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"TS_RANK(POW(TS_CORR($close, SEQUENCE(20), 20), 2), 10) * TS_RANK($volume / ($high - $low + 1e-6), 5)\" # Your output factor expression will be filled in here\n    name = \"Volume_Absorption_Reversal_Index\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor measures the interaction between price trend stability and the relative volume intensity. It uses a 20-day window for trend stability to capture more established trends and a 5-day window for volume intensity to capture short-term 'climax' behavior.",
      "factor_formulation": "\\text{TS_RANK}(\\text{POW}(\\text{TS_CORR}(\\text{close}, \\text{SEQUENCE}(20), 20), 2), 10) * \\text{TS_RANK}(\\frac{\\text{volume}}{\\text{high} - \\text{low} + 1e-6}, 5)",
      "metadata": {
        "experiment_id": "2026-01-18_23-34-31-850258",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "fb92d294f7b1",
        "parent_trajectory_ids": [
          "492e236353d7",
          "65524478b0e4"
        ],
        "hypothesis": "Hypothesis: The 'Fragile Trend Exhaustion' factor identifies imminent reversals by detecting periods where high price linearity (10-day R-squared) coincides with a peak in the volume-to-price-range ratio (Z-score), signaling that institutional urgency is no longer producing efficient price movement.\n                Concise Observation: Parent 1 showed that volume surges relative to price extension signal exhaustion (RankIC 0.0239), while Parent 2 showed that high trend efficiency without volume support is unsustainable (RankIC 0.0251).\n                Concise Justification: Combining R-squared (trend orderliness) with a volume-to-range Z-score allows us to distinguish between healthy trend continuation and institutional 'climax' events where high volume fails to push prices further due to hidden liquidity absorption.\n                Concise Knowledge: If a high-linearity trend is accompanied by an increasing volume-to-range ratio, it indicates 'hollow' price action where liquidity is being exhausted; such trends are prone to reversal as the marginal impact of volume on price diminishes.\n                concise Specification: The factor is calculated as the product of the 10-day price-time R-squared and the 5-day Z-score of the ratio ($volume / ($high - $low + 1e-6)), where higher values predict a negative return for the following period.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T13:19:29.497056"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.0874486949749601,
        "ICIR": 0.0564645834771815,
        "1day.excess_return_without_cost.std": 0.0042639184534908,
        "1day.excess_return_with_cost.annualized_return": 0.0164677775734017,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002662110002972,
        "1day.excess_return_without_cost.annualized_return": 0.0633582180707404,
        "1day.excess_return_with_cost.std": 0.0042647608834794,
        "Rank IC": 0.0254984465937458,
        "IC": 0.0076790104212653,
        "1day.excess_return_without_cost.max_drawdown": -0.0784557186502475,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.9631758514861204,
        "1day.pa": 0.0,
        "l2.valid": 0.9965829411895698,
        "Rank ICIR": 0.1908088946512743,
        "l2.train": 0.993774407663575,
        "1day.excess_return_with_cost.information_ratio": 0.2502948004202984,
        "1day.excess_return_with_cost.mean": 6.919234274538563e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of the 'Fragile Trend Exhaustion' hypothesis. The results show a significant improvement in IC (0.007679 vs 0.005798) and Annualized Return (0.063358 vs 0.052010) compared to the SOTA, although the Information Ratio and Max Drawdown slightly deteriorated. The interaction between price linearity (R-squared) and volume efficiency (volume/range) appears to be a valid predictor of short-term reversals. The 'Volume_Absorption_Reversal_Index' specifically leveraged different lookback periods (20-day for trend, 5-day for volume) which likely contributed to the improved capture of climax behavior.",
        "hypothesis_evaluation": "The hypothesis that high price linearity combined with volume-to-range peaks signals exhaustion is strongly supported by the increase in IC and Annualized Return. However, the slight increase in Max Drawdown suggests that while the signal is predictive, it may be volatile or prone to 'false climaxes' in strong trending markets. The use of TS_RANK and RANK in the second and third factors helped normalize the signals, making them more robust than the raw Z-score used in the first iteration.",
        "decision": true,
        "reason": "The current results prove that volume-to-range is a good proxy for absorption. By refining this to 'Price Displacement Efficiency' (ABS(Return)/Volume) and anchoring it to price extremes (distance from rolling highs/lows), we can better distinguish between a healthy trend continuation and a true exhaustion climax. Using a 10-day window for linearity provides a balance between responsiveness and stability, while the efficiency metric should be short-term (3-5 days) to catch the immediate 'churning' at the peak."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_213430",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_213430",
        "factor_dir": "8c268d691bed4e46982bec96337b7279",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_213430/8c268d691bed4e46982bec96337b7279/result.h5"
      }
    },
    "0b9dea4e3967a2e6": {
      "factor_id": "0b9dea4e3967a2e6",
      "factor_name": "MRIF_Efficiency_Factor_20D",
      "factor_expression": "((DELAY($close, 1) - $open) / ($high - $low + 1e-8)) * (TS_QUANTILE($low / $open, 20, 0.95) / (TS_CORR(LOG($return + 2), LOG($volume + 1), 20) + 2))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"((DELAY($close, 1) - $open) / ($high - $low + 1e-8)) * (TS_QUANTILE($low / $open, 20, 0.95) / (TS_CORR(TS_PCTCHANGE($close, 1), $volume, 20) + 2))\" # Your output factor expression will be filled in here\n    name = \"MRIF_Efficiency_Factor_20D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "The Mean-Reversion Institutional Floor (MRIF) factor combines short-term exhaustion with long-term structural support. It multiplies the 1-day intraday mean-reversion efficiency (overnight gap relative to current range) by a 20-day institutional support metric (95th percentile of Low/Open ratio normalized by price-volume correlation).",
      "factor_formulation": "MRIF = \\left( \\frac{DELAY(close, 1) - open}{high - low + 1e-8} \\right) \\times \\left( \\frac{TS\\_QUANTILE(low/open, 20, 0.95)}{TS\\_CORR(LOG(return+1), LOG(volume+1), 20) + 2} \\right)",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "696435dc0afa",
        "parent_trajectory_ids": [
          "ef6b9ff2f88a",
          "7329054553ab"
        ],
        "hypothesis": "Hypothesis: The Mean-Reversion Institutional Floor (MRIF) factor, defined as the product of the 1-day Intraday Mean-Reversion Efficiency (overnight gap relative to high-low range) and the 20-day Institutional Support-Volume Efficiency (Low/Open percentile divided by price-volume correlation), identifies high-probability reversals where short-term price exhaustion meets long-term structural support.\n                Concise Observation: Parent 1 (IMRE) captures tactical exhaustion but lacks structural context, while Parent 2 (ISVE) identifies institutional floors but lacks a precise timing trigger; combining them addresses the noise in raw mean-reversion signals by filtering for stocks with established 'quiet' accumulation floors.\n                Concise Justification: The overnight gap normalized by the high-low range measures the intensity of a potential reversal trigger, while the 20-day institutional metric ensures this trigger is backed by a price floor where sellers are exhausted and buyers are passive, reducing the risk of catching a 'falling knife'.\n                Concise Knowledge: If a stock's intraday price exhaustion occurs while long-term institutional support is present (high Low/Open stability and low price-volume correlation), then the subsequent mean-reversion is more robust; when price reversals happen on low volume, they indicate a lack of institutional distribution, increasing the probability of a successful bounce.\n                concise Specification: The factor is calculated as ( (Close[t-1] - Open[t]) / (High[t] - Low[t] + eps) ) * ( Rolling_95th_Percentile(Low[t-20:t]/Open[t-20:t], 20) / (Rolling_Correlation(Log_Return[t-20:t], Log_Volume[t-20:t], 20) + 2) ), where the addition of 2 to the correlation ensures a positive, non-zero denominator.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T08:44:12.083677"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.134976121136123,
        "ICIR": 0.0551251513931209,
        "1day.excess_return_without_cost.std": 0.0045180512138258,
        "1day.excess_return_with_cost.annualized_return": 0.0058176171356476,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002199649221175,
        "1day.excess_return_without_cost.annualized_return": 0.0523516514639847,
        "1day.excess_return_with_cost.std": 0.0045174083718091,
        "Rank IC": 0.0253916729054469,
        "IC": 0.00737327157558,
        "1day.excess_return_without_cost.max_drawdown": -0.1114421423515783,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.751087887388615,
        "1day.pa": 0.0,
        "l2.valid": 0.996435967000204,
        "Rank ICIR": 0.1927130708280696,
        "l2.train": 0.9938130901757576,
        "1day.excess_return_with_cost.information_ratio": 0.0834770908262495,
        "1day.excess_return_with_cost.mean": 2.444376947751131e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of the Mean-Reversion Institutional Floor (MRIF) hypothesis. The 'MRIF_Efficiency_Factor_20D' achieved a higher IC (0.007373) and a slightly higher annualized return (0.052352) compared to the previous SOTA, although it suffered from a significantly higher max drawdown (-0.111442 vs -0.072585) and a lower Information Ratio. This suggests that while the core idea of combining intraday mean reversion with institutional support has predictive power (high IC), the current multiplicative formulation introduces significant volatility and tail risk.",
        "hypothesis_evaluation": "The hypothesis that combining short-term exhaustion with long-term structural support identifies reversals is supported by the improved IC and Annualized Return. However, the 'Institutional_Support_Floor_Rank' and 'Tactical_Exhaustion_Trigger' results (implicitly reflected in the combined performance) suggest that the interaction between these two components is non-linear. The current MRIF factor is somewhat complex (using 6 base features: open, close, high, low, volume, return), which is at the limit of the recommended complexity threshold (ER <= 6). The high drawdown suggests the 'Institutional Support' part of the formula might be unstable during market regimes where price-volume correlations shift rapidly.",
        "decision": true,
        "reason": "The previous MRIF factor's high drawdown is likely caused by the product of two distinct distributions, which amplifies outliers. By using a Z-score sum (Linear Combination), we can balance the signals. Reducing the institutional window from 20 to 10 days will make the 'floor' more responsive to recent structural changes. Additionally, simplifying the 'Institutional Support' component by focusing on the ratio of Low to the Moving Average (instead of the complex Quantile/Correlation ratio) will reduce the Base Feature count and improve robustness."
      },
      "cache_location": null
    },
    "96749b352d715d1c": {
      "factor_id": "96749b352d715d1c",
      "factor_name": "Institutional_Support_Floor_Rank",
      "factor_expression": "RANK(TS_QUANTILE($low / $open, 20, 0.95)) - RANK(TS_CORR($return, $volume, 20))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(TS_QUANTILE($low / $open, 20, 0.95)) - RANK(TS_CORR(TS_PCTCHANGE($close, 1), $volume, 20))\" # Your output factor expression will be filled in here\n    name = \"Institutional_Support_Floor_Rank\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A simplified version of the MRIF hypothesis focusing on the cross-sectional rank of institutional support. It identifies stocks where the low-price stability is high relative to the price-volume trend, suggesting an accumulation floor where price drops are met with passive buying.",
      "factor_formulation": "ISFR = RANK(TS\\_QUANTILE(low/open, 20, 0.95)) - RANK(TS\\_CORR(return, volume, 20))",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "696435dc0afa",
        "parent_trajectory_ids": [
          "ef6b9ff2f88a",
          "7329054553ab"
        ],
        "hypothesis": "Hypothesis: The Mean-Reversion Institutional Floor (MRIF) factor, defined as the product of the 1-day Intraday Mean-Reversion Efficiency (overnight gap relative to high-low range) and the 20-day Institutional Support-Volume Efficiency (Low/Open percentile divided by price-volume correlation), identifies high-probability reversals where short-term price exhaustion meets long-term structural support.\n                Concise Observation: Parent 1 (IMRE) captures tactical exhaustion but lacks structural context, while Parent 2 (ISVE) identifies institutional floors but lacks a precise timing trigger; combining them addresses the noise in raw mean-reversion signals by filtering for stocks with established 'quiet' accumulation floors.\n                Concise Justification: The overnight gap normalized by the high-low range measures the intensity of a potential reversal trigger, while the 20-day institutional metric ensures this trigger is backed by a price floor where sellers are exhausted and buyers are passive, reducing the risk of catching a 'falling knife'.\n                Concise Knowledge: If a stock's intraday price exhaustion occurs while long-term institutional support is present (high Low/Open stability and low price-volume correlation), then the subsequent mean-reversion is more robust; when price reversals happen on low volume, they indicate a lack of institutional distribution, increasing the probability of a successful bounce.\n                concise Specification: The factor is calculated as ( (Close[t-1] - Open[t]) / (High[t] - Low[t] + eps) ) * ( Rolling_95th_Percentile(Low[t-20:t]/Open[t-20:t], 20) / (Rolling_Correlation(Log_Return[t-20:t], Log_Volume[t-20:t], 20) + 2) ), where the addition of 2 to the correlation ensures a positive, non-zero denominator.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T08:44:12.083677"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.134976121136123,
        "ICIR": 0.0551251513931209,
        "1day.excess_return_without_cost.std": 0.0045180512138258,
        "1day.excess_return_with_cost.annualized_return": 0.0058176171356476,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002199649221175,
        "1day.excess_return_without_cost.annualized_return": 0.0523516514639847,
        "1day.excess_return_with_cost.std": 0.0045174083718091,
        "Rank IC": 0.0253916729054469,
        "IC": 0.00737327157558,
        "1day.excess_return_without_cost.max_drawdown": -0.1114421423515783,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.751087887388615,
        "1day.pa": 0.0,
        "l2.valid": 0.996435967000204,
        "Rank ICIR": 0.1927130708280696,
        "l2.train": 0.9938130901757576,
        "1day.excess_return_with_cost.information_ratio": 0.0834770908262495,
        "1day.excess_return_with_cost.mean": 2.444376947751131e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of the Mean-Reversion Institutional Floor (MRIF) hypothesis. The 'MRIF_Efficiency_Factor_20D' achieved a higher IC (0.007373) and a slightly higher annualized return (0.052352) compared to the previous SOTA, although it suffered from a significantly higher max drawdown (-0.111442 vs -0.072585) and a lower Information Ratio. This suggests that while the core idea of combining intraday mean reversion with institutional support has predictive power (high IC), the current multiplicative formulation introduces significant volatility and tail risk.",
        "hypothesis_evaluation": "The hypothesis that combining short-term exhaustion with long-term structural support identifies reversals is supported by the improved IC and Annualized Return. However, the 'Institutional_Support_Floor_Rank' and 'Tactical_Exhaustion_Trigger' results (implicitly reflected in the combined performance) suggest that the interaction between these two components is non-linear. The current MRIF factor is somewhat complex (using 6 base features: open, close, high, low, volume, return), which is at the limit of the recommended complexity threshold (ER <= 6). The high drawdown suggests the 'Institutional Support' part of the formula might be unstable during market regimes where price-volume correlations shift rapidly.",
        "decision": true,
        "reason": "The previous MRIF factor's high drawdown is likely caused by the product of two distinct distributions, which amplifies outliers. By using a Z-score sum (Linear Combination), we can balance the signals. Reducing the institutional window from 20 to 10 days will make the 'floor' more responsive to recent structural changes. Additionally, simplifying the 'Institutional Support' component by focusing on the ratio of Low to the Moving Average (instead of the complex Quantile/Correlation ratio) will reduce the Base Feature count and improve robustness."
      },
      "cache_location": null
    },
    "6f3012ada83a7c98": {
      "factor_id": "6f3012ada83a7c98",
      "factor_name": "Tactical_Exhaustion_Trigger",
      "factor_expression": "TS_MEAN((DELAY($close, 1) - $open) / ($high - $low + 1e-8), 5)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"TS_MEAN((DELAY($close, 1) - $open) / ($high - $low + 1e-8), 5)\" # Your output factor expression will be filled in here\n    name = \"Tactical_Exhaustion_Trigger\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "Captures the tactical exhaustion component of the MRIF hypothesis. It measures the overnight gap magnitude relative to the daily volatility (High-Low range), smoothed over 5 days to identify consistent mean-reversion triggers.",
      "factor_formulation": "TET = TS\\_MEAN(\\frac{DELAY(close, 1) - open}{high - low + 1e-8}, 5)",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "696435dc0afa",
        "parent_trajectory_ids": [
          "ef6b9ff2f88a",
          "7329054553ab"
        ],
        "hypothesis": "Hypothesis: The Mean-Reversion Institutional Floor (MRIF) factor, defined as the product of the 1-day Intraday Mean-Reversion Efficiency (overnight gap relative to high-low range) and the 20-day Institutional Support-Volume Efficiency (Low/Open percentile divided by price-volume correlation), identifies high-probability reversals where short-term price exhaustion meets long-term structural support.\n                Concise Observation: Parent 1 (IMRE) captures tactical exhaustion but lacks structural context, while Parent 2 (ISVE) identifies institutional floors but lacks a precise timing trigger; combining them addresses the noise in raw mean-reversion signals by filtering for stocks with established 'quiet' accumulation floors.\n                Concise Justification: The overnight gap normalized by the high-low range measures the intensity of a potential reversal trigger, while the 20-day institutional metric ensures this trigger is backed by a price floor where sellers are exhausted and buyers are passive, reducing the risk of catching a 'falling knife'.\n                Concise Knowledge: If a stock's intraday price exhaustion occurs while long-term institutional support is present (high Low/Open stability and low price-volume correlation), then the subsequent mean-reversion is more robust; when price reversals happen on low volume, they indicate a lack of institutional distribution, increasing the probability of a successful bounce.\n                concise Specification: The factor is calculated as ( (Close[t-1] - Open[t]) / (High[t] - Low[t] + eps) ) * ( Rolling_95th_Percentile(Low[t-20:t]/Open[t-20:t], 20) / (Rolling_Correlation(Log_Return[t-20:t], Log_Volume[t-20:t], 20) + 2) ), where the addition of 2 to the correlation ensures a positive, non-zero denominator.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T08:44:12.083677"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.134976121136123,
        "ICIR": 0.0551251513931209,
        "1day.excess_return_without_cost.std": 0.0045180512138258,
        "1day.excess_return_with_cost.annualized_return": 0.0058176171356476,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002199649221175,
        "1day.excess_return_without_cost.annualized_return": 0.0523516514639847,
        "1day.excess_return_with_cost.std": 0.0045174083718091,
        "Rank IC": 0.0253916729054469,
        "IC": 0.00737327157558,
        "1day.excess_return_without_cost.max_drawdown": -0.1114421423515783,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.751087887388615,
        "1day.pa": 0.0,
        "l2.valid": 0.996435967000204,
        "Rank ICIR": 0.1927130708280696,
        "l2.train": 0.9938130901757576,
        "1day.excess_return_with_cost.information_ratio": 0.0834770908262495,
        "1day.excess_return_with_cost.mean": 2.444376947751131e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of the Mean-Reversion Institutional Floor (MRIF) hypothesis. The 'MRIF_Efficiency_Factor_20D' achieved a higher IC (0.007373) and a slightly higher annualized return (0.052352) compared to the previous SOTA, although it suffered from a significantly higher max drawdown (-0.111442 vs -0.072585) and a lower Information Ratio. This suggests that while the core idea of combining intraday mean reversion with institutional support has predictive power (high IC), the current multiplicative formulation introduces significant volatility and tail risk.",
        "hypothesis_evaluation": "The hypothesis that combining short-term exhaustion with long-term structural support identifies reversals is supported by the improved IC and Annualized Return. However, the 'Institutional_Support_Floor_Rank' and 'Tactical_Exhaustion_Trigger' results (implicitly reflected in the combined performance) suggest that the interaction between these two components is non-linear. The current MRIF factor is somewhat complex (using 6 base features: open, close, high, low, volume, return), which is at the limit of the recommended complexity threshold (ER <= 6). The high drawdown suggests the 'Institutional Support' part of the formula might be unstable during market regimes where price-volume correlations shift rapidly.",
        "decision": true,
        "reason": "The previous MRIF factor's high drawdown is likely caused by the product of two distinct distributions, which amplifies outliers. By using a Z-score sum (Linear Combination), we can balance the signals. Reducing the institutional window from 20 to 10 days will make the 'floor' more responsive to recent structural changes. Additionally, simplifying the 'Institutional Support' component by focusing on the ratio of Low to the Moving Average (instead of the complex Quantile/Correlation ratio) will reduce the Base Feature count and improve robustness."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221528",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528",
        "factor_dir": "e222924ebd1746e38d082b44d8593f0b",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528/e222924ebd1746e38d082b44d8593f0b/result.h5"
      }
    },
    "49dca20750297634": {
      "factor_id": "49dca20750297634",
      "factor_name": "IBMRS_Composite_Factor_V1",
      "factor_expression": "ZSCORE(($open - DELAY($close, 1)) / ($high - $low + 1e-8)) * ZSCORE(TS_QUANTILE($low / $open, 20, 0.95)) * ZSCORE(TS_CORR($return, TS_PCTCHANGE($volume, 1), 10))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"ZSCORE(($open - DELAY($close, 1)) / ($high - $low + 1e-8)) * ZSCORE(TS_QUANTILE($low / $open, 20, 0.95)) * ZSCORE(TS_CORR(TS_PCTCHANGE($close, 1), TS_PCTCHANGE($volume, 1), 10))\" # Your output factor expression will be filled in here\n    name = \"IBMRS_Composite_Factor_V1\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "The Institutional-Backed Mean-Reversion Springboard (IBMRS) factor identifies reversal points by combining tactical exhaustion (overnight gap relative to intraday range) with institutional support (95th percentile of low/open) and volume conviction (price-volume correlation).",
      "factor_formulation": "ZSCORE(\\frac{open - DELAY(close, 1)}{high - low + 1e-8}) * ZSCORE(TS\\_QUANTILE(\\frac{low}{open}, 20, 0.95)) * ZSCORE(TS\\_CORR(return, TS\\_PCTCHANGE(volume, 1), 10))",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "b58cace41659",
        "parent_trajectory_ids": [
          "ef6b9ff2f88a",
          "f3323be14550"
        ],
        "hypothesis": "Hypothesis: The Institutional-Backed Mean-Reversion Springboard (IBMRS) factor, calculated as the product of the Intraday Mean-Reversion Efficiency (overnight gap divided by high-low range) and a composite Institutional Support Strength (20-day 95th percentile of low/open scaled by 10-day price-volume correlation), identifies high-conviction reversal points at structural support levels.\n                Concise Observation: Parent 1 captures tactical exhaustion (RankIC 0.024) but lacks a quality filter, while Parent 2 identifies structural support (RankIC 0.0286) but lacks a precise timing trigger; combining them addresses the 'dead-cat bounce' risk in mean-reversion strategies.\n                Concise Justification: The overnight gap represents a sentiment shock, and the intraday range represents the market's capacity to absorb that shock; by filtering these shocks through a 20-day institutional floor and volume conviction, we isolate reversals that are supported by liquidity rather than just noise.\n                Concise Knowledge: If short-term price exhaustion (high gap relative to range) occurs at a level where institutional support is historically dense (high low/open percentile) and volume confirms accumulation (positive price-volume correlation), then the probability of a structural mean-reversion reversal increases; otherwise, price gaps without support are likely 'falling knives'.\n                concise Specification: The factor is the product of (Overnight Gap / (High - Low + epsilon)) and (Rolling 20-day 95th percentile of Low/Open) and (Rolling 10-day Correlation of Return and Volume Change); all components are Z-scored cross-sectionally before multiplication to ensure scale neutrality.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T09:13:37.391847"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.16352243768659,
        "ICIR": 0.0481635698492721,
        "1day.excess_return_without_cost.std": 0.0042794343137696,
        "1day.excess_return_with_cost.annualized_return": -0.0131683049524276,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0001427464312049,
        "1day.excess_return_without_cost.annualized_return": 0.0339736506267781,
        "1day.excess_return_with_cost.std": 0.0042800237594965,
        "Rank IC": 0.0248645863539386,
        "IC": 0.0065798058549614,
        "1day.excess_return_without_cost.max_drawdown": -0.107219910927664,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.5145971458909815,
        "1day.pa": 0.0,
        "l2.valid": 0.9962989660070276,
        "Rank ICIR": 0.1853679409521557,
        "l2.train": 0.993595138617866,
        "1day.excess_return_with_cost.information_ratio": -0.1994321710036039,
        "1day.excess_return_with_cost.mean": -5.5329012405158015e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of the Institutional-Backed Mean-Reversion Springboard (IBMRS) hypothesis. While the 'IBMRS_Composite_Factor_V1' achieved a higher IC (0.006580) compared to the SOTA (0.005798), it significantly underperformed in risk-adjusted returns (IR of 0.51 vs 0.97) and experienced a deeper drawdown (-0.107 vs -0.072). The composite factor's complexity, involving five raw features ($open, $close, $high, $low, $volume) and multiple Z-score/rolling operations, suggests that the interaction between tactical exhaustion and institutional support is currently being modeled with too much noise or over-parameterization, leading to poor translation from IC to realized returns.",
        "hypothesis_evaluation": "The hypothesis that combining overnight gaps with institutional 'floor' levels (low/open quantile) identifies reversal points is partially supported by the improved IC, indicating a valid signal exists. However, the multiplicative combination of three Z-scored components (Exhaustion * Support * Conviction) appears to create an unstable signal. The 'Institutional_Support_Timing_Factor' and 'Tactical_Exhaustion_Reversal_Factor' were intended to isolate these effects, but the aggregated result shows that the complexity of the composite version is likely hindering its generalization and portfolio performance.",
        "decision": false,
        "reason": "The current SOTA has a much higher Information Ratio, suggesting it is more robust. To improve, we must address the 'Complexity Impact' noted in the instructions. By moving from a product of three Z-scores to a simpler ranking of the institutional support level filtered by a basic volume-price trend, we reduce the 'Symbol Length' and 'Free Parameters'. Specifically, using a 20-day quantile of (low/close) or (low/open) as a standalone feature, combined with a simpler volume filter, should provide a cleaner signal with less overfitting than the current V1 composite."
      },
      "cache_location": null
    },
    "a2eb6d85f3dd97e9": {
      "factor_id": "a2eb6d85f3dd97e9",
      "factor_name": "Institutional_Support_Timing_Factor",
      "factor_expression": "RANK(TS_QUANTILE($low / $open, 20, 0.95)) * RANK(TS_CORR($return, DELTA($volume, 1) / ($volume + 1e-8), 10))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(TS_QUANTILE($low / $open, 20, 0.95)) * RANK(TS_CORR($close / DELAY($close, 1) - 1, DELTA($volume, 1) / ($volume + 1e-8), 10))\" # Your output factor expression will be filled in here\n    name = \"Institutional_Support_Timing_Factor\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A simplified version of the IBMRS hypothesis focusing on the interaction between institutional floor levels (20-day high-quantile low/open) and price-volume trend confirmation to filter mean-reversion signals.",
      "factor_formulation": "RANK(TS\\_QUANTILE(low/open, 20, 0.95)) * RANK(TS\\_CORR(return, DELTA(volume, 1)/volume, 10))",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "b58cace41659",
        "parent_trajectory_ids": [
          "ef6b9ff2f88a",
          "f3323be14550"
        ],
        "hypothesis": "Hypothesis: The Institutional-Backed Mean-Reversion Springboard (IBMRS) factor, calculated as the product of the Intraday Mean-Reversion Efficiency (overnight gap divided by high-low range) and a composite Institutional Support Strength (20-day 95th percentile of low/open scaled by 10-day price-volume correlation), identifies high-conviction reversal points at structural support levels.\n                Concise Observation: Parent 1 captures tactical exhaustion (RankIC 0.024) but lacks a quality filter, while Parent 2 identifies structural support (RankIC 0.0286) but lacks a precise timing trigger; combining them addresses the 'dead-cat bounce' risk in mean-reversion strategies.\n                Concise Justification: The overnight gap represents a sentiment shock, and the intraday range represents the market's capacity to absorb that shock; by filtering these shocks through a 20-day institutional floor and volume conviction, we isolate reversals that are supported by liquidity rather than just noise.\n                Concise Knowledge: If short-term price exhaustion (high gap relative to range) occurs at a level where institutional support is historically dense (high low/open percentile) and volume confirms accumulation (positive price-volume correlation), then the probability of a structural mean-reversion reversal increases; otherwise, price gaps without support are likely 'falling knives'.\n                concise Specification: The factor is the product of (Overnight Gap / (High - Low + epsilon)) and (Rolling 20-day 95th percentile of Low/Open) and (Rolling 10-day Correlation of Return and Volume Change); all components are Z-scored cross-sectionally before multiplication to ensure scale neutrality.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T09:13:37.391847"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.16352243768659,
        "ICIR": 0.0481635698492721,
        "1day.excess_return_without_cost.std": 0.0042794343137696,
        "1day.excess_return_with_cost.annualized_return": -0.0131683049524276,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0001427464312049,
        "1day.excess_return_without_cost.annualized_return": 0.0339736506267781,
        "1day.excess_return_with_cost.std": 0.0042800237594965,
        "Rank IC": 0.0248645863539386,
        "IC": 0.0065798058549614,
        "1day.excess_return_without_cost.max_drawdown": -0.107219910927664,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.5145971458909815,
        "1day.pa": 0.0,
        "l2.valid": 0.9962989660070276,
        "Rank ICIR": 0.1853679409521557,
        "l2.train": 0.993595138617866,
        "1day.excess_return_with_cost.information_ratio": -0.1994321710036039,
        "1day.excess_return_with_cost.mean": -5.5329012405158015e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of the Institutional-Backed Mean-Reversion Springboard (IBMRS) hypothesis. While the 'IBMRS_Composite_Factor_V1' achieved a higher IC (0.006580) compared to the SOTA (0.005798), it significantly underperformed in risk-adjusted returns (IR of 0.51 vs 0.97) and experienced a deeper drawdown (-0.107 vs -0.072). The composite factor's complexity, involving five raw features ($open, $close, $high, $low, $volume) and multiple Z-score/rolling operations, suggests that the interaction between tactical exhaustion and institutional support is currently being modeled with too much noise or over-parameterization, leading to poor translation from IC to realized returns.",
        "hypothesis_evaluation": "The hypothesis that combining overnight gaps with institutional 'floor' levels (low/open quantile) identifies reversal points is partially supported by the improved IC, indicating a valid signal exists. However, the multiplicative combination of three Z-scored components (Exhaustion * Support * Conviction) appears to create an unstable signal. The 'Institutional_Support_Timing_Factor' and 'Tactical_Exhaustion_Reversal_Factor' were intended to isolate these effects, but the aggregated result shows that the complexity of the composite version is likely hindering its generalization and portfolio performance.",
        "decision": false,
        "reason": "The current SOTA has a much higher Information Ratio, suggesting it is more robust. To improve, we must address the 'Complexity Impact' noted in the instructions. By moving from a product of three Z-scores to a simpler ranking of the institutional support level filtered by a basic volume-price trend, we reduce the 'Symbol Length' and 'Free Parameters'. Specifically, using a 20-day quantile of (low/close) or (low/open) as a standalone feature, combined with a simpler volume filter, should provide a cleaner signal with less overfitting than the current V1 composite."
      },
      "cache_location": null
    },
    "f5e3d81126ce6c4a": {
      "factor_id": "f5e3d81126ce6c4a",
      "factor_name": "Tactical_Exhaustion_Reversal_Factor",
      "factor_expression": "ZSCORE(($open - DELAY($close, 1)) / ($high - $low + 1e-8)) * ZSCORE(TS_CORR($close, $volume, 10))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"ZSCORE(($open - DELAY($close, 1)) / ($high - $low + 1e-8)) * ZSCORE(TS_CORR($close, $volume, 10))\" # Your output factor expression will be filled in here\n    name = \"Tactical_Exhaustion_Reversal_Factor\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor captures tactical exhaustion by measuring the overnight gap relative to the total intraday volatility, normalized by the 10-day price-volume correlation to ensure the reversal is backed by liquidity.",
      "factor_formulation": "ZSCORE(\\frac{open - DELAY(close, 1)}{high - low + 1e-8}) * ZSCORE(TS\\_CORR(close, volume, 10))",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "b58cace41659",
        "parent_trajectory_ids": [
          "ef6b9ff2f88a",
          "f3323be14550"
        ],
        "hypothesis": "Hypothesis: The Institutional-Backed Mean-Reversion Springboard (IBMRS) factor, calculated as the product of the Intraday Mean-Reversion Efficiency (overnight gap divided by high-low range) and a composite Institutional Support Strength (20-day 95th percentile of low/open scaled by 10-day price-volume correlation), identifies high-conviction reversal points at structural support levels.\n                Concise Observation: Parent 1 captures tactical exhaustion (RankIC 0.024) but lacks a quality filter, while Parent 2 identifies structural support (RankIC 0.0286) but lacks a precise timing trigger; combining them addresses the 'dead-cat bounce' risk in mean-reversion strategies.\n                Concise Justification: The overnight gap represents a sentiment shock, and the intraday range represents the market's capacity to absorb that shock; by filtering these shocks through a 20-day institutional floor and volume conviction, we isolate reversals that are supported by liquidity rather than just noise.\n                Concise Knowledge: If short-term price exhaustion (high gap relative to range) occurs at a level where institutional support is historically dense (high low/open percentile) and volume confirms accumulation (positive price-volume correlation), then the probability of a structural mean-reversion reversal increases; otherwise, price gaps without support are likely 'falling knives'.\n                concise Specification: The factor is the product of (Overnight Gap / (High - Low + epsilon)) and (Rolling 20-day 95th percentile of Low/Open) and (Rolling 10-day Correlation of Return and Volume Change); all components are Z-scored cross-sectionally before multiplication to ensure scale neutrality.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T09:13:37.391847"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.16352243768659,
        "ICIR": 0.0481635698492721,
        "1day.excess_return_without_cost.std": 0.0042794343137696,
        "1day.excess_return_with_cost.annualized_return": -0.0131683049524276,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0001427464312049,
        "1day.excess_return_without_cost.annualized_return": 0.0339736506267781,
        "1day.excess_return_with_cost.std": 0.0042800237594965,
        "Rank IC": 0.0248645863539386,
        "IC": 0.0065798058549614,
        "1day.excess_return_without_cost.max_drawdown": -0.107219910927664,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.5145971458909815,
        "1day.pa": 0.0,
        "l2.valid": 0.9962989660070276,
        "Rank ICIR": 0.1853679409521557,
        "l2.train": 0.993595138617866,
        "1day.excess_return_with_cost.information_ratio": -0.1994321710036039,
        "1day.excess_return_with_cost.mean": -5.5329012405158015e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of the Institutional-Backed Mean-Reversion Springboard (IBMRS) hypothesis. While the 'IBMRS_Composite_Factor_V1' achieved a higher IC (0.006580) compared to the SOTA (0.005798), it significantly underperformed in risk-adjusted returns (IR of 0.51 vs 0.97) and experienced a deeper drawdown (-0.107 vs -0.072). The composite factor's complexity, involving five raw features ($open, $close, $high, $low, $volume) and multiple Z-score/rolling operations, suggests that the interaction between tactical exhaustion and institutional support is currently being modeled with too much noise or over-parameterization, leading to poor translation from IC to realized returns.",
        "hypothesis_evaluation": "The hypothesis that combining overnight gaps with institutional 'floor' levels (low/open quantile) identifies reversal points is partially supported by the improved IC, indicating a valid signal exists. However, the multiplicative combination of three Z-scored components (Exhaustion * Support * Conviction) appears to create an unstable signal. The 'Institutional_Support_Timing_Factor' and 'Tactical_Exhaustion_Reversal_Factor' were intended to isolate these effects, but the aggregated result shows that the complexity of the composite version is likely hindering its generalization and portfolio performance.",
        "decision": false,
        "reason": "The current SOTA has a much higher Information Ratio, suggesting it is more robust. To improve, we must address the 'Complexity Impact' noted in the instructions. By moving from a product of three Z-scores to a simpler ranking of the institutional support level filtered by a basic volume-price trend, we reduce the 'Symbol Length' and 'Free Parameters'. Specifically, using a 20-day quantile of (low/close) or (low/open) as a standalone feature, combined with a simpler volume filter, should provide a cleaner signal with less overfitting than the current V1 composite."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221528",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528",
        "factor_dir": "17f950d4906a4831bf4f18450d5f5542",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528/17f950d4906a4831bf4f18450d5f5542/result.h5"
      }
    },
    "49036f683257a346": {
      "factor_id": "49036f683257a346",
      "factor_name": "IVSE_Core_Factor_10_20",
      "factor_expression": "TS_MEAN(($close - $open) / ($high - $low + 1e-8), 10) * (TS_QUANTILE($low / $open, 20, 0.95) / (ABS(TS_CORR(LOG($close / (DELAY($close, 1) + 1e-8) + 1e-8), LOG($volume + 1e-8), 20)) + 1e-8))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"TS_MEAN(($close - $open) / ($high - $low + 1e-8), 10) * (TS_QUANTILE($low / $open, 20, 0.95) / (ABS(TS_CORR(LOG($close / (DELAY($close, 1) + 1e-8) + 1e-8), LOG($volume + 1e-8), 20)) + 1e-8))\" # Your output factor expression will be filled in here\n    name = \"IVSE_Core_Factor_10_20\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "The Institutional Velocity-Support Equilibrium (IVSE) factor. It combines a 10-day breakout intensity (average price movement relative to daily range) with a 20-day support efficiency metric. Support efficiency is defined as the 95th percentile of the Low/Open ratio (identifying structural floors) divided by the correlation between log returns and log volume (identifying institutional accumulation via low price-volume synchronization).",
      "factor_formulation": "\\text{TS_MEAN}(\\frac{close - open}{high - low + 1e-8}, 10) \\times \\frac{\\text{TS_QUANTILE}(low / open, 20, 0.95)}{\\text{ABS}(\\text{TS_CORR}(\\text{LOG}(close/delay(close,1)), \\text{LOG}(volume), 20)) + 1e-8}",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "626f3255e9d9",
        "parent_trajectory_ids": [
          "7fbab4d1b9e3",
          "7329054553ab"
        ],
        "hypothesis": "Hypothesis: The Institutional Velocity-Support Equilibrium (IVSE) factor, defined as the product of a 10-day volatility-adjusted breakout intensity and the 20-day 'support efficiency' (95th percentile of Low/Open ratio divided by Price-Volume correlation), identifies sustainable institutional trends emerging from stable price floors.\n                Concise Observation: Parent 1 captures breakout momentum but is prone to false signals in volatile regimes, while Parent 2 identifies stable accumulation floors but lacks a timing trigger for trend initiation.\n                Concise Justification: Institutional investors build positions at structural floors to minimize slippage; a subsequent breakout characterized by expanding price ranges and efficient volume usage signals the transition from accumulation to an active trend, reducing the risk of retail-driven 'blow-offs'.\n                Concise Knowledge: If a price breakout occurs from a high-conviction support floor (high Low/Open ratio) with low price-volume synchronization (low correlation), it indicates institutional accumulation; when combined with high-intensity volatility expansion, it predicts superior medium-term returns compared to simple momentum.\n                concise Specification: The factor is calculated by multiplying the 10-day average of ((Close-Open)/(High-Low)) by the ratio of the 20-day 95th percentile of (Low/Open) to the 20-day spearman correlation between log returns and log volume.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T08:33:49.230401"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1535301867194786,
        "ICIR": 0.0446343913751501,
        "1day.excess_return_without_cost.std": 0.0051650992332418,
        "1day.excess_return_with_cost.annualized_return": 0.0370230583645457,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003542539517088,
        "1day.excess_return_without_cost.annualized_return": 0.0843124405067125,
        "1day.excess_return_with_cost.std": 0.005167902117356,
        "Rank IC": 0.0248641340315425,
        "IC": 0.0071679661701604,
        "1day.excess_return_without_cost.max_drawdown": -0.1202035999365556,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.0580946349779956,
        "1day.pa": 0.0,
        "l2.valid": 0.9964876162231424,
        "Rank ICIR": 0.1607510536951916,
        "l2.train": 0.9938643752106148,
        "1day.excess_return_with_cost.information_ratio": 0.4643757514019121,
        "1day.excess_return_with_cost.mean": 0.0001555590687585
      },
      "feedback": {
        "observations": "The current iteration focused on the 'Institutional Velocity-Support Equilibrium' (IVSE) framework, testing three variations that combine breakout intensity with price-volume synchronization and support floor metrics. The results show a significant improvement in Information Ratio (1.058 vs 0.973), Annualized Return (0.084 vs 0.052), and IC (0.0072 vs 0.0058) compared to the SOTA. However, this performance gain comes at the cost of a higher Max Drawdown (-0.120 vs -0.072), suggesting increased volatility in the factor's signal. The 'Simplified_IVSE_Momentum' and 'Institutional_Floor_Breakout' factors successfully leveraged cross-sectional ranking and simpler ratio structures, which likely contributed to the improved predictive power.",
        "hypothesis_evaluation": "The results strongly support the IVSE hypothesis. The core ideathat institutional trends are best identified when price breakouts occur alongside low price-volume synchronization (suggesting stealthy accumulation)is validated by the higher IC and IR. The inclusion of 'support efficiency' (Low/Open ratios) appears to provide a structural anchor that filters out noise. However, the complexity of the 'IVSE_Core_Factor_10_20' (using 5 base features: high, low, open, close, volume) is approaching the threshold for over-engineering. The success of the 'Simplified_IVSE_Momentum' suggests that the interaction between the components is more important than the raw complexity of the individual metrics.",
        "decision": true,
        "reason": "1. The current Max Drawdown is high; replacing the 95th percentile quantile (which can be noisy) with a 20-day standard deviation of the Low/Open ratio will better capture 'stable floors'. 2. To address complexity, we should reduce the number of base features; specifically, the (close-open)/(high-low) breakout intensity can be simplified to a simple Close/Open ratio or a 10-day momentum rank. 3. The inverse correlation between return and volume remains a strong proxy for institutional 'stealth' and should be retained but perhaps smoothed to reduce signal turnover."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221528",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528",
        "factor_dir": "aaa387d0980e4b5ebb76319c31e77872",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221528/aaa387d0980e4b5ebb76319c31e77872/result.h5"
      }
    },
    "321a563cae4620e3": {
      "factor_id": "321a563cae4620e3",
      "factor_name": "Simplified_IVSE_Momentum",
      "factor_expression": "RANK(TS_MEAN(($close - $open) / ($high - $low + 1e-8), 10)) * RANK(INV(ABS(TS_CORR($return, $volume, 20)) + 1e-8))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(TS_MEAN(($close - $open) / ($high - $low + 1e-8), 10)) * RANK(INV(ABS(TS_CORR(TS_PCTCHANGE($close, 1), $volume, 20)) + 1e-8))\" # Your output factor expression will be filled in here\n    name = \"Simplified_IVSE_Momentum\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A simplified version of the IVSE hypothesis focusing on the interaction between breakout intensity and price-volume divergence. It uses the rank of breakout intensity scaled by the inverse of the return-volume correlation to highlight periods where price moves are not yet fully synchronized with volume, often seen in institutional accumulation.",
      "factor_formulation": "\\text{RANK}(\\text{TS_MEAN}(\\frac{close-open}{high-low+1e-8}, 10)) \\times \\text{RANK}(\\text{INV}(\\text{ABS}(\\text{TS_CORR}(return, volume, 20)) + 1e-8))",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "626f3255e9d9",
        "parent_trajectory_ids": [
          "7fbab4d1b9e3",
          "7329054553ab"
        ],
        "hypothesis": "Hypothesis: The Institutional Velocity-Support Equilibrium (IVSE) factor, defined as the product of a 10-day volatility-adjusted breakout intensity and the 20-day 'support efficiency' (95th percentile of Low/Open ratio divided by Price-Volume correlation), identifies sustainable institutional trends emerging from stable price floors.\n                Concise Observation: Parent 1 captures breakout momentum but is prone to false signals in volatile regimes, while Parent 2 identifies stable accumulation floors but lacks a timing trigger for trend initiation.\n                Concise Justification: Institutional investors build positions at structural floors to minimize slippage; a subsequent breakout characterized by expanding price ranges and efficient volume usage signals the transition from accumulation to an active trend, reducing the risk of retail-driven 'blow-offs'.\n                Concise Knowledge: If a price breakout occurs from a high-conviction support floor (high Low/Open ratio) with low price-volume synchronization (low correlation), it indicates institutional accumulation; when combined with high-intensity volatility expansion, it predicts superior medium-term returns compared to simple momentum.\n                concise Specification: The factor is calculated by multiplying the 10-day average of ((Close-Open)/(High-Low)) by the ratio of the 20-day 95th percentile of (Low/Open) to the 20-day spearman correlation between log returns and log volume.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T08:33:49.230401"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1535301867194786,
        "ICIR": 0.0446343913751501,
        "1day.excess_return_without_cost.std": 0.0051650992332418,
        "1day.excess_return_with_cost.annualized_return": 0.0370230583645457,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003542539517088,
        "1day.excess_return_without_cost.annualized_return": 0.0843124405067125,
        "1day.excess_return_with_cost.std": 0.005167902117356,
        "Rank IC": 0.0248641340315425,
        "IC": 0.0071679661701604,
        "1day.excess_return_without_cost.max_drawdown": -0.1202035999365556,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.0580946349779956,
        "1day.pa": 0.0,
        "l2.valid": 0.9964876162231424,
        "Rank ICIR": 0.1607510536951916,
        "l2.train": 0.9938643752106148,
        "1day.excess_return_with_cost.information_ratio": 0.4643757514019121,
        "1day.excess_return_with_cost.mean": 0.0001555590687585
      },
      "feedback": {
        "observations": "The current iteration focused on the 'Institutional Velocity-Support Equilibrium' (IVSE) framework, testing three variations that combine breakout intensity with price-volume synchronization and support floor metrics. The results show a significant improvement in Information Ratio (1.058 vs 0.973), Annualized Return (0.084 vs 0.052), and IC (0.0072 vs 0.0058) compared to the SOTA. However, this performance gain comes at the cost of a higher Max Drawdown (-0.120 vs -0.072), suggesting increased volatility in the factor's signal. The 'Simplified_IVSE_Momentum' and 'Institutional_Floor_Breakout' factors successfully leveraged cross-sectional ranking and simpler ratio structures, which likely contributed to the improved predictive power.",
        "hypothesis_evaluation": "The results strongly support the IVSE hypothesis. The core ideathat institutional trends are best identified when price breakouts occur alongside low price-volume synchronization (suggesting stealthy accumulation)is validated by the higher IC and IR. The inclusion of 'support efficiency' (Low/Open ratios) appears to provide a structural anchor that filters out noise. However, the complexity of the 'IVSE_Core_Factor_10_20' (using 5 base features: high, low, open, close, volume) is approaching the threshold for over-engineering. The success of the 'Simplified_IVSE_Momentum' suggests that the interaction between the components is more important than the raw complexity of the individual metrics.",
        "decision": true,
        "reason": "1. The current Max Drawdown is high; replacing the 95th percentile quantile (which can be noisy) with a 20-day standard deviation of the Low/Open ratio will better capture 'stable floors'. 2. To address complexity, we should reduce the number of base features; specifically, the (close-open)/(high-low) breakout intensity can be simplified to a simple Close/Open ratio or a 10-day momentum rank. 3. The inverse correlation between return and volume remains a strong proxy for institutional 'stealth' and should be retained but perhaps smoothed to reduce signal turnover."
      },
      "cache_location": null
    },
    "94d106b04254eb46": {
      "factor_id": "94d106b04254eb46",
      "factor_name": "Institutional_Floor_Breakout",
      "factor_expression": "TS_PCTCHANGE($close, 10) / (TS_MIN($low / $open, 20) * (1 + TS_CORR($return, $volume, 20) + 1e-8))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"TS_PCTCHANGE($close, 10) / (TS_MIN($low / $open, 20) * (1 + TS_CORR(TS_PCTCHANGE($close, 1), $volume, 20) + 1e-8))\" # Your output factor expression will be filled in here\n    name = \"Institutional_Floor_Breakout\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor identifies stocks breaking out from a stable floor. It measures the 10-day price velocity relative to the 20-day support stability (proxied by the rolling minimum Low/Open ratio) and penalizes high price-volume correlation to filter for institutional entry.",
      "factor_formulation": "\\frac{\\text{TS_PCTCHANGE}(close, 10)}{\\text{TS_MIN}(low/open, 20) \\times (1 + \\text{TS_CORR}(return, volume, 20))}",
      "metadata": {
        "experiment_id": "2026-01-18_21-40-12-932281",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "626f3255e9d9",
        "parent_trajectory_ids": [
          "7fbab4d1b9e3",
          "7329054553ab"
        ],
        "hypothesis": "Hypothesis: The Institutional Velocity-Support Equilibrium (IVSE) factor, defined as the product of a 10-day volatility-adjusted breakout intensity and the 20-day 'support efficiency' (95th percentile of Low/Open ratio divided by Price-Volume correlation), identifies sustainable institutional trends emerging from stable price floors.\n                Concise Observation: Parent 1 captures breakout momentum but is prone to false signals in volatile regimes, while Parent 2 identifies stable accumulation floors but lacks a timing trigger for trend initiation.\n                Concise Justification: Institutional investors build positions at structural floors to minimize slippage; a subsequent breakout characterized by expanding price ranges and efficient volume usage signals the transition from accumulation to an active trend, reducing the risk of retail-driven 'blow-offs'.\n                Concise Knowledge: If a price breakout occurs from a high-conviction support floor (high Low/Open ratio) with low price-volume synchronization (low correlation), it indicates institutional accumulation; when combined with high-intensity volatility expansion, it predicts superior medium-term returns compared to simple momentum.\n                concise Specification: The factor is calculated by multiplying the 10-day average of ((Close-Open)/(High-Low)) by the ratio of the 20-day 95th percentile of (Low/Open) to the 20-day spearman correlation between log returns and log volume.\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T08:33:49.230401"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1535301867194786,
        "ICIR": 0.0446343913751501,
        "1day.excess_return_without_cost.std": 0.0051650992332418,
        "1day.excess_return_with_cost.annualized_return": 0.0370230583645457,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003542539517088,
        "1day.excess_return_without_cost.annualized_return": 0.0843124405067125,
        "1day.excess_return_with_cost.std": 0.005167902117356,
        "Rank IC": 0.0248641340315425,
        "IC": 0.0071679661701604,
        "1day.excess_return_without_cost.max_drawdown": -0.1202035999365556,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.0580946349779956,
        "1day.pa": 0.0,
        "l2.valid": 0.9964876162231424,
        "Rank ICIR": 0.1607510536951916,
        "l2.train": 0.9938643752106148,
        "1day.excess_return_with_cost.information_ratio": 0.4643757514019121,
        "1day.excess_return_with_cost.mean": 0.0001555590687585
      },
      "feedback": {
        "observations": "The current iteration focused on the 'Institutional Velocity-Support Equilibrium' (IVSE) framework, testing three variations that combine breakout intensity with price-volume synchronization and support floor metrics. The results show a significant improvement in Information Ratio (1.058 vs 0.973), Annualized Return (0.084 vs 0.052), and IC (0.0072 vs 0.0058) compared to the SOTA. However, this performance gain comes at the cost of a higher Max Drawdown (-0.120 vs -0.072), suggesting increased volatility in the factor's signal. The 'Simplified_IVSE_Momentum' and 'Institutional_Floor_Breakout' factors successfully leveraged cross-sectional ranking and simpler ratio structures, which likely contributed to the improved predictive power.",
        "hypothesis_evaluation": "The results strongly support the IVSE hypothesis. The core ideathat institutional trends are best identified when price breakouts occur alongside low price-volume synchronization (suggesting stealthy accumulation)is validated by the higher IC and IR. The inclusion of 'support efficiency' (Low/Open ratios) appears to provide a structural anchor that filters out noise. However, the complexity of the 'IVSE_Core_Factor_10_20' (using 5 base features: high, low, open, close, volume) is approaching the threshold for over-engineering. The success of the 'Simplified_IVSE_Momentum' suggests that the interaction between the components is more important than the raw complexity of the individual metrics.",
        "decision": true,
        "reason": "1. The current Max Drawdown is high; replacing the 95th percentile quantile (which can be noisy) with a 20-day standard deviation of the Low/Open ratio will better capture 'stable floors'. 2. To address complexity, we should reduce the number of base features; specifically, the (close-open)/(high-low) breakout intensity can be simplified to a simple Close/Open ratio or a 10-day momentum rank. 3. The inverse correlation between return and volume remains a strong proxy for institutional 'stealth' and should be retained but perhaps smoothed to reduce signal turnover."
      },
      "cache_location": null
    },
    "bbf0c7e783770b14": {
      "factor_id": "bbf0c7e783770b14",
      "factor_name": "Institutional_Stealth_Gap_Convergence_20D",
      "factor_expression": "RANK(TS_MEAN(($open / DELAY($close, 1)) - 1, 20) / (TS_STD(($close / $open) - 1, 20) + 1e-8)) * RANK(-1 * TS_CORR(($close / DELAY($close, 1)) - 1, $volume, 20))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(TS_MEAN(($open / DELAY($close, 1)) - 1, 20) / (TS_STD(($close / $open) - 1, 20) + 1e-8)) * RANK(-1 * TS_CORR(($close / DELAY($close, 1)) - 1, $volume, 20))\" # Your output factor expression will be filled in here\n    name = \"Institutional_Stealth_Gap_Convergence_20D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor identifies institutional accumulation by combining normalized overnight returns with price-volume decoupling. It calculates the 20-day mean of overnight returns divided by the 20-day standard deviation of intraday returns, then multiplies this by the negated 20-day correlation between price changes and volume to capture 'stealth' moves on thinning volume.",
      "factor_formulation": "\\text{RANK}\\left(\\frac{\\text{TS\\_MEAN}((\\text{open}/\\text{DELAY}(\\text{close}, 1)) - 1, 20)}{\\text{TS\\_STD}((\\text{close}/\\text{open}) - 1, 20) + 1e-8}\\right) * \\text{RANK}(-\\text{TS\\_CORR}(\\text{close}/\\text{DELAY}(\\text{close}, 1) - 1, \\text{volume}, 20))",
      "metadata": {
        "experiment_id": "2026-01-19_04-13-15-519909",
        "round_number": 4,
        "evolution_phase": "crossover",
        "trajectory_id": "75887843510f",
        "parent_trajectory_ids": [
          "29bacf7b4535",
          "bb589d983d76"
        ],
        "hypothesis": "Hypothesis: The 'Institutional Stealth-Gap Convergence' factor, defined as the product of the 20-day average overnight return (normalized by 20-day intraday volatility) and the 20-day rank of price-volume decoupling, captures high-conviction institutional positioning by filtering overnight momentum through structural volume exhaustion.\n                Concise Observation: Parent 1 showed that overnight inertia is a strong alpha source (RankIC 0.03), while Parent 2 highlighted that price-volume decoupling identifies structural exhaustion; however, both suffer from 'trap' signals where overnight gaps occur without institutional support or during retail-driven blow-offs.\n                Concise Justification: By multiplying the inertia signal with the decoupling rank, we isolate periods where the market is moving upward on thin volume (decoupling), which, when paired with positive overnight returns, suggests that institutions are absorbing liquidity quietly rather than competing for it intraday.\n                Concise Knowledge: If overnight returns are persistent and normalized by intraday risk, they indicate institutional intent; when this intent coincides with price-volume decoupling (increasing price on decreasing volume), it signifies 'stealth' accumulation where supply is exhausted, leading to higher predictive alpha than either signal alone.\n                concise Specification: Calculate the 20-day mean of (Open/PrevClose - 1) divided by the 20-day standard deviation of (Close/Open - 1), then multiply this value by the 20-day Spearman correlation between daily price change and daily volume (negated to represent decoupling).\n                ",
        "initial_direction": null,
        "planning_direction": null,
        "created_at": "2026-01-19T16:02:23.831405"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1244536073512695,
        "ICIR": 0.0468060222598926,
        "1day.excess_return_without_cost.std": 0.00423451553558,
        "1day.excess_return_with_cost.annualized_return": 0.0067079750861149,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002278445775971,
        "1day.excess_return_without_cost.annualized_return": 0.0542270094681214,
        "1day.excess_return_with_cost.std": 0.004235485437549,
        "Rank IC": 0.0244517102404377,
        "IC": 0.0062475580212218,
        "1day.excess_return_without_cost.max_drawdown": -0.1089847645523913,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.8300866807310051,
        "1day.pa": 0.0,
        "l2.valid": 0.9965794291786436,
        "Rank ICIR": 0.183407019722927,
        "l2.train": 0.9938114534669372,
        "1day.excess_return_with_cost.information_ratio": 0.1026596476939137,
        "1day.excess_return_with_cost.mean": 2.818476926939036e-05
      },
      "feedback": {
        "observations": "The experiment tested two variations of the 'Institutional Stealth-Gap Convergence' hypothesis. The 20-day version (Institutional_Stealth_Gap_Convergence_20D) successfully improved the Information Coefficient (IC) and Annualized Return compared to the previous SOTA, although it showed higher volatility as evidenced by the increased Max Drawdown and lower Information Ratio. The 10-day tactical version (Stealth_Accumulation_Efficiency_10D) was also implemented but the combined results suggest the longer-term structural filter (20-day) is more robust for capturing institutional positioning. The core mechanismmultiplying normalized overnight gaps by price-volume decouplingshows promise in identifying high-conviction moves.",
        "hypothesis_evaluation": "The hypothesis that 'Institutional Stealth-Gap Convergence' captures institutional positioning is partially supported. The improvement in IC (0.0062 vs 0.0058) and Annualized Return (5.42% vs 5.20%) suggests that filtering overnight momentum through volume exhaustion (negative correlation between price change and volume) adds predictive value. However, the drop in Information Ratio and increase in Drawdown indicate that the current formulation might be capturing high-beta or volatile segments, requiring better risk-adjustment or a more stable normalization method.",
        "decision": true,
        "reason": "The current 20-day factor uses a simple RANK product which can be sensitive to outliers. By using a gap-to-range ratio (Open - PrevClose) / (High - Low), we isolate the 'surprise' element of the gap relative to the day's total volatility. Furthermore, the current use of TS_CORR(return, volume, 20) might be improved by focusing specifically on the 'negative' side of the correlation (volume exhaustion on price increases) rather than a linear correlation, which can be noisy. Simplifying the expression to focus on the ratio of overnight strength to intraday volatility will address the complexity concerns while potentially stabilizing the Information Ratio."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260118_221443",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221443",
        "factor_dir": "5b61192a7ee240478162aa7792b5ab75",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260118_221443/5b61192a7ee240478162aa7792b5ab75/result.h5"
      }
    }
  }
}